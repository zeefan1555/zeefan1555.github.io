

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://hexoblogzeefan.oss-cn-guangzhou.aliyuncs.com/img/202206251952371.png">
  <link rel="icon" href="https://hexoblogzeefan.oss-cn-guangzhou.aliyuncs.com/img/202206251952371.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="zeefan">
  <meta name="keywords" content="">
  
    <meta name="description" content="üìùRedis21-40 ÁõÆÂΩï::   1: [[21„ÄÅÂ¶Ç‰ΩïËß£ÂÜ≥RedisÁöÑÂπ∂ÂèëÁ´û‰∫âKeyÈóÆÈ¢ò]]  2: [[22„ÄÅÂ¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂÜôÊó∂ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß]]  3: [[23„ÄÅÊï∞ÊçÆ‰∏∫‰ªÄ‰πà‰ºöÂá∫Áé∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºü]]  4: [[24„ÄÅÂ∏∏ËßÅÁöÑÊï∞ÊçÆ‰ºòÂåñÊñπÊ°à‰Ω†‰∫ÜËß£ÂêóÔºü]]  5: [[25„ÄÅRedis ÁöÑÈ´òÂπ∂ÂèëÂíåÈ´òÂèØÁî®ÊòØÂ¶Ç‰Ωï‰øùËØÅÁöÑÔºü]]  6: [[26„ÄÅRedis Â¶Ç‰ΩïÊâçËÉΩÂÅöÂà∞È´òÂèØÁî®Ôºü]]  7: [">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis21-40 ÁõÆÂΩï">
<meta property="og:url" content="https://zeefan1555.github.io/posts/2/index.html">
<meta property="og:site_name" content="‰∏ÄÊùØÁ©∫Ê∞î">
<meta property="og:description" content="üìùRedis21-40 ÁõÆÂΩï::   1: [[21„ÄÅÂ¶Ç‰ΩïËß£ÂÜ≥RedisÁöÑÂπ∂ÂèëÁ´û‰∫âKeyÈóÆÈ¢ò]]  2: [[22„ÄÅÂ¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂÜôÊó∂ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß]]  3: [[23„ÄÅÊï∞ÊçÆ‰∏∫‰ªÄ‰πà‰ºöÂá∫Áé∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºü]]  4: [[24„ÄÅÂ∏∏ËßÅÁöÑÊï∞ÊçÆ‰ºòÂåñÊñπÊ°à‰Ω†‰∫ÜËß£ÂêóÔºü]]  5: [[25„ÄÅRedis ÁöÑÈ´òÂπ∂ÂèëÂíåÈ´òÂèØÁî®ÊòØÂ¶Ç‰Ωï‰øùËØÅÁöÑÔºü]]  6: [[26„ÄÅRedis Â¶Ç‰ΩïÊâçËÉΩÂÅöÂà∞È´òÂèØÁî®Ôºü]]  7: [">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301730.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301262.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301899.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301027.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301343.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301991.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301481.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301684.png">
<meta property="og:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301751.png">
<meta property="article:published_time" content="2022-12-27T03:38:00.000Z">
<meta property="article:modified_time" content="2022-12-30T03:21:29.619Z">
<meta property="article:author" content="zeefan">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301730.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Redis21-40 ÁõÆÂΩï - ‰∏ÄÊùØÁ©∫Ê∞î</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.15.6/katex.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"zeefan1555.github.io","root":"/","version":"1.9.1","typing":{"enable":true,"typeSpeed":150,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"Text"},"copy_btn":true,"image_caption":{"enable":false},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":10},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>‰∏ÄÊùØÁ©∫Ê∞î</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                È¶ñÈ°µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                ÂΩíÊ°£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                ÂàÜÁ±ª
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Ê†áÁ≠æ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                ÂÖ≥‰∫é
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Redis21-40 ÁõÆÂΩï"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-27 11:38" pubdate>
          2022Âπ¥12Êúà27Êó• ‰∏≠Âçà
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          58 ÂàÜÈíü
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> Ê¨°
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Redis21-40 ÁõÆÂΩï</h1>
            
              <p class="note note-info">
                
                  
                    Êú¨ÊñáÊúÄÂêéÊõ¥Êñ∞‰∫éÔºö2022Âπ¥12Êúà30Êó• ‰∏äÂçà
                  
                
              </p>
            
            <div class="markdown-body">
              
              <p>üìùRedis21-40 ÁõÆÂΩï::</p>
<!-- basicblock-end -->
<h1 id="1-21-Â¶Ç‰ΩïËß£ÂÜ≥redisÁöÑÂπ∂ÂèëÁ´û‰∫âkeyÈóÆÈ¢ò"><a class="markdownIt-Anchor" href="#1-21-Â¶Ç‰ΩïËß£ÂÜ≥redisÁöÑÂπ∂ÂèëÁ´û‰∫âkeyÈóÆÈ¢ò"></a> 1: [[21„ÄÅÂ¶Ç‰ΩïËß£ÂÜ≥RedisÁöÑÂπ∂ÂèëÁ´û‰∫âKeyÈóÆÈ¢ò]]</h1>
<h1 id="2-22-Â¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂÜôÊó∂ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß"><a class="markdownIt-Anchor" href="#2-22-Â¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂÜôÊó∂ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß"></a> 2: [[22„ÄÅÂ¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂÜôÊó∂ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß]]</h1>
<h1 id="3-23-Êï∞ÊçÆ‰∏∫‰ªÄ‰πà‰ºöÂá∫Áé∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ"><a class="markdownIt-Anchor" href="#3-23-Êï∞ÊçÆ‰∏∫‰ªÄ‰πà‰ºöÂá∫Áé∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ"></a> 3: [[23„ÄÅÊï∞ÊçÆ‰∏∫‰ªÄ‰πà‰ºöÂá∫Áé∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºü]]</h1>
<h1 id="4-24-Â∏∏ËßÅÁöÑÊï∞ÊçÆ‰ºòÂåñÊñπÊ°à‰Ω†‰∫ÜËß£Âêó"><a class="markdownIt-Anchor" href="#4-24-Â∏∏ËßÅÁöÑÊï∞ÊçÆ‰ºòÂåñÊñπÊ°à‰Ω†‰∫ÜËß£Âêó"></a> 4: [[24„ÄÅÂ∏∏ËßÅÁöÑÊï∞ÊçÆ‰ºòÂåñÊñπÊ°à‰Ω†‰∫ÜËß£ÂêóÔºü]]</h1>
<h1 id="5-25-redis-ÁöÑÈ´òÂπ∂ÂèëÂíåÈ´òÂèØÁî®ÊòØÂ¶Ç‰Ωï‰øùËØÅÁöÑ"><a class="markdownIt-Anchor" href="#5-25-redis-ÁöÑÈ´òÂπ∂ÂèëÂíåÈ´òÂèØÁî®ÊòØÂ¶Ç‰Ωï‰øùËØÅÁöÑ"></a> 5: [[25„ÄÅRedis ÁöÑÈ´òÂπ∂ÂèëÂíåÈ´òÂèØÁî®ÊòØÂ¶Ç‰Ωï‰øùËØÅÁöÑÔºü]]</h1>
<h1 id="6-26-redis-Â¶Ç‰ΩïÊâçËÉΩÂÅöÂà∞È´òÂèØÁî®"><a class="markdownIt-Anchor" href="#6-26-redis-Â¶Ç‰ΩïÊâçËÉΩÂÅöÂà∞È´òÂèØÁî®"></a> 6: [[26„ÄÅRedis Â¶Ç‰ΩïÊâçËÉΩÂÅöÂà∞È´òÂèØÁî®Ôºü]]</h1>
<h1 id="7-27-redisÈõÜ‰∫éÂì®ÂÖµÈõÜÁæ§ÂÆûÁé∞È´òÂèØÁî®"><a class="markdownIt-Anchor" href="#7-27-redisÈõÜ‰∫éÂì®ÂÖµÈõÜÁæ§ÂÆûÁé∞È´òÂèØÁî®"></a> 7: [[27„ÄÅRedisÈõÜ‰∫éÂì®ÂÖµÈõÜÁæ§ÂÆûÁé∞È´òÂèØÁî®Ôºü]]</h1>
<h1 id="8-28-redis-Âì®ÂÖµ‰∏ªÂ§áÂàáÊç¢ÁöÑÊï∞ÊçÆ‰∏¢Â§±ÈóÆÈ¢ò"><a class="markdownIt-Anchor" href="#8-28-redis-Âì®ÂÖµ‰∏ªÂ§áÂàáÊç¢ÁöÑÊï∞ÊçÆ‰∏¢Â§±ÈóÆÈ¢ò"></a> 8: 28„ÄÅRedis Âì®ÂÖµ‰∏ªÂ§áÂàáÊç¢ÁöÑÊï∞ÊçÆ‰∏¢Â§±ÈóÆÈ¢ò</h1>
<h2 id="81-ÂØºËá¥Êï∞ÊçÆ‰∏¢Â§±ÁöÑ‰∏§ÁßçÊÉÖÂÜµ"><a class="markdownIt-Anchor" href="#81-ÂØºËá¥Êï∞ÊçÆ‰∏¢Â§±ÁöÑ‰∏§ÁßçÊÉÖÂÜµ"></a> 8.1: ÂØºËá¥Êï∞ÊçÆ‰∏¢Â§±ÁöÑ‰∏§ÁßçÊÉÖÂÜµ</h2>
<p>‰∏ªÂ§áÂàáÊç¢ÁöÑËøáÁ®ãÔºåÂèØËÉΩ‰ºöÂØºËá¥Êï∞ÊçÆ‰∏¢Â§±Ôºö</p>
<ul>
<li>ÂºÇÊ≠•Â§çÂà∂ÂØºËá¥ÁöÑÊï∞ÊçÆ‰∏¢Â§±</li>
</ul>
<p>Âõ†‰∏∫ master-&gt;slave ÁöÑÂ§çÂà∂ÊòØÂºÇÊ≠•ÁöÑÔºåÊâÄ‰ª•ÂèØËÉΩÊúâÈÉ®ÂàÜÊï∞ÊçÆËøòÊ≤°Â§çÂà∂Âà∞ slaveÔºåmaster Â∞±ÂÆïÊú∫‰∫ÜÔºåÊ≠§Êó∂ËøôÈÉ®ÂàÜÊï∞ÊçÆÂ∞±‰∏¢Â§±‰∫Ü„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301730.png" srcset="/img/loading.gif" lazyload alt="async-replication-data-lose-case"></p>
<ul>
<li>ËÑëË£ÇÂØºËá¥ÁöÑÊï∞ÊçÆ‰∏¢Â§±</li>
</ul>
<p>ËÑëË£ÇÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÊüê‰∏™ master ÊâÄÂú®Êú∫Âô®Á™ÅÁÑ∂<strong>ËÑ±Á¶ª‰∫ÜÊ≠£Â∏∏ÁöÑÁΩëÁªú</strong>ÔºåË∑üÂÖ∂‰ªñ slave Êú∫Âô®‰∏çËÉΩËøûÊé•Ôºå‰ΩÜÊòØÂÆûÈôÖ‰∏ä master ËøòËøêË°åÁùÄ„ÄÇÊ≠§Êó∂Âì®ÂÖµÂèØËÉΩÂ∞±‰ºö<strong>ËÆ§‰∏∫</strong> master ÂÆïÊú∫‰∫ÜÔºåÁÑ∂ÂêéÂºÄÂêØÈÄâ‰∏æÔºåÂ∞ÜÂÖ∂‰ªñ slave ÂàáÊç¢Êàê‰∫Ü master„ÄÇËøô‰∏™Êó∂ÂÄôÔºåÈõÜÁæ§ÈáåÂ∞±‰ºöÊúâ‰∏§‰∏™ master Ôºå‰πüÂ∞±ÊòØÊâÄË∞ìÁöÑ<strong>ËÑëË£Ç</strong>„ÄÇ</p>
<p>Ê≠§Êó∂ËôΩÁÑ∂Êüê‰∏™ slave Ë¢´ÂàáÊç¢Êàê‰∫Ü masterÔºå‰ΩÜÊòØÂèØËÉΩ client ËøòÊ≤°Êù•ÂæóÂèäÂàáÊç¢Âà∞Êñ∞ÁöÑ masterÔºåËøòÁªßÁª≠ÂêëÊóß master ÂÜôÊï∞ÊçÆ„ÄÇÂõ†Ê≠§Êóß master ÂÜçÊ¨°ÊÅ¢Â§çÁöÑÊó∂ÂÄôÔºå‰ºöË¢´‰Ωú‰∏∫‰∏Ä‰∏™ slave ÊåÇÂà∞Êñ∞ÁöÑ master ‰∏äÂéªÔºåËá™Â∑±ÁöÑÊï∞ÊçÆ‰ºöÊ∏ÖÁ©∫ÔºåÈáçÊñ∞‰ªéÊñ∞ÁöÑ master Â§çÂà∂Êï∞ÊçÆ„ÄÇËÄåÊñ∞ÁöÑ master Âπ∂Ê≤°ÊúâÂêéÊù• client ÂÜôÂÖ•ÁöÑÊï∞ÊçÆÔºåÂõ†Ê≠§ÔºåËøôÈÉ®ÂàÜÊï∞ÊçÆ‰πüÂ∞±‰∏¢Â§±‰∫Ü„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301262.png" srcset="/img/loading.gif" lazyload alt="Redis-cluster-split-brain"></p>
<h2 id="82-Êï∞ÊçÆ‰∏¢Â§±ÈóÆÈ¢òÁöÑËß£ÂÜ≥ÊñπÊ°à"><a class="markdownIt-Anchor" href="#82-Êï∞ÊçÆ‰∏¢Â§±ÈóÆÈ¢òÁöÑËß£ÂÜ≥ÊñπÊ°à"></a> 8.2: Êï∞ÊçÆ‰∏¢Â§±ÈóÆÈ¢òÁöÑËß£ÂÜ≥ÊñπÊ°à</h2>
<p>ËøõË°åÂ¶Ç‰∏ãÈÖçÁΩÆÔºö</p>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">min</span>-slaves-<span class="hljs-built_in">to</span>-<span class="hljs-built_in">write</span> <span class="hljs-number">1</span><br><span class="hljs-built_in">min</span>-slaves-<span class="hljs-built_in">max</span>-lag <span class="hljs-number">10</span>Copy <span class="hljs-built_in">to</span> clipboardErrorCopied<br></code></pre></td></tr></tbody></table></figure>
<p>Ë°®Á§∫ÔºåË¶ÅÊ±ÇËá≥Â∞ëÊúâ 1 ‰∏™ slaveÔºåÊï∞ÊçÆÂ§çÂà∂ÂíåÂêåÊ≠•ÁöÑÂª∂Ëøü‰∏çËÉΩË∂ÖËøá 10 Áßí„ÄÇ</p>
<p>Â¶ÇÊûúËØ¥‰∏ÄÊó¶ÊâÄÊúâÁöÑ slaveÔºåÊï∞ÊçÆÂ§çÂà∂ÂíåÂêåÊ≠•ÁöÑÂª∂ËøüÈÉΩË∂ÖËøá‰∫Ü 10 ÁßíÈíüÔºåÈÇ£‰πàËøô‰∏™Êó∂ÂÄôÔºåmaster Â∞±‰∏ç‰ºöÂÜçÊé•Êî∂‰ªª‰ΩïËØ∑Ê±Ç‰∫Ü„ÄÇ</p>
<ul>
<li>ÂáèÂ∞ëÂºÇÊ≠•Â§çÂà∂Êï∞ÊçÆÁöÑ‰∏¢Â§±</li>
</ul>
<p>Êúâ‰∫Ü <code>min-slaves-max-lag</code> Ëøô‰∏™ÈÖçÁΩÆÔºåÂ∞±ÂèØ‰ª•Á°Æ‰øùËØ¥Ôºå‰∏ÄÊó¶ slave Â§çÂà∂Êï∞ÊçÆÂíå ack Âª∂Êó∂Â§™ÈïøÔºåÂ∞±ËÆ§‰∏∫ÂèØËÉΩ master ÂÆïÊú∫ÂêéÊçüÂ§±ÁöÑÊï∞ÊçÆÂ§™Â§ö‰∫ÜÔºåÈÇ£‰πàÂ∞±ÊãíÁªùÂÜôËØ∑Ê±ÇÔºåËøôÊ†∑ÂèØ‰ª•Êää master ÂÆïÊú∫Êó∂Áî±‰∫éÈÉ®ÂàÜÊï∞ÊçÆÊú™ÂêåÊ≠•Âà∞ slave ÂØºËá¥ÁöÑÊï∞ÊçÆ‰∏¢Â§±Èôç‰ΩéÁöÑÂèØÊéßËåÉÂõ¥ÂÜÖ„ÄÇ</p>
<ul>
<li>ÂáèÂ∞ëËÑëË£ÇÁöÑÊï∞ÊçÆ‰∏¢Â§±</li>
</ul>
<p>Â¶ÇÊûú‰∏Ä‰∏™ master Âá∫Áé∞‰∫ÜËÑëË£ÇÔºåË∑üÂÖ∂‰ªñ slave ‰∏¢‰∫ÜËøûÊé•ÔºåÈÇ£‰πà‰∏äÈù¢‰∏§‰∏™ÈÖçÁΩÆÂèØ‰ª•Á°Æ‰øùËØ¥ÔºåÂ¶ÇÊûú‰∏çËÉΩÁªßÁª≠ÁªôÊåáÂÆöÊï∞ÈáèÁöÑ slave ÂèëÈÄÅÊï∞ÊçÆÔºåËÄå‰∏î slave Ë∂ÖËøá 10 ÁßíÊ≤°ÊúâÁªôËá™Â∑± ack Ê∂àÊÅØÔºåÈÇ£‰πàÂ∞±Áõ¥Êé•ÊãíÁªùÂÆ¢Êà∑Á´ØÁöÑÂÜôËØ∑Ê±Ç„ÄÇÂõ†Ê≠§Âú®ËÑëË£ÇÂú∫ÊôØ‰∏ãÔºåÊúÄÂ§öÂ∞±‰∏¢Â§± 10 ÁßíÁöÑÊï∞ÊçÆ„ÄÇ</p>
<h1 id="9-29-sdown-Âíå-odown-ËΩ¨Êç¢Êú∫Âà∂"><a class="markdownIt-Anchor" href="#9-29-sdown-Âíå-odown-ËΩ¨Êç¢Êú∫Âà∂"></a> 9: 29„ÄÅsdown Âíå odown ËΩ¨Êç¢Êú∫Âà∂</h1>
<ul>
<li>sdown ÊòØ‰∏ªËßÇÂÆïÊú∫ÔºåÂ∞±‰∏Ä‰∏™Âì®ÂÖµÂ¶ÇÊûúËá™Â∑±ËßâÂæó‰∏Ä‰∏™ master ÂÆïÊú∫‰∫ÜÔºåÈÇ£‰πàÂ∞±ÊòØ‰∏ªËßÇÂÆïÊú∫</li>
<li>odown ÊòØÂÆ¢ËßÇÂÆïÊú∫ÔºåÂ¶ÇÊûú quorum Êï∞ÈáèÁöÑÂì®ÂÖµÈÉΩËßâÂæó‰∏Ä‰∏™ master ÂÆïÊú∫‰∫ÜÔºåÈÇ£‰πàÂ∞±ÊòØÂÆ¢ËßÇÂÆïÊú∫</li>
</ul>
<p>sdown ËææÊàêÁöÑÊù°‰ª∂ÂæàÁÆÄÂçïÔºåÂ¶ÇÊûú‰∏Ä‰∏™Âì®ÂÖµ ping ‰∏Ä‰∏™ masterÔºåË∂ÖËøá‰∫Ü <code>is-master-down-after-milliseconds</code> ÊåáÂÆöÁöÑÊØ´ÁßíÊï∞‰πãÂêéÔºåÂ∞±‰∏ªËßÇËÆ§‰∏∫ master ÂÆïÊú∫‰∫ÜÔºõÂ¶ÇÊûú‰∏Ä‰∏™Âì®ÂÖµÂú®ÊåáÂÆöÊó∂Èó¥ÂÜÖÔºåÊî∂Âà∞‰∫Ü quorum Êï∞ÈáèÁöÑÂÖ∂ÂÆÉÂì®ÂÖµ‰πüËÆ§‰∏∫ÈÇ£‰∏™ master ÊòØ sdown ÁöÑÔºåÈÇ£‰πàÂ∞±ËÆ§‰∏∫ÊòØ odown ‰∫Ü„ÄÇ</p>
<h1 id="10-30-Âì®ÂÖµÈõÜÁæ§ÁöÑËá™Âä®ÂèëÁé∞Êú∫Âà∂"><a class="markdownIt-Anchor" href="#10-30-Âì®ÂÖµÈõÜÁæ§ÁöÑËá™Âä®ÂèëÁé∞Êú∫Âà∂"></a> 10: 30„ÄÅÂì®ÂÖµÈõÜÁæ§ÁöÑËá™Âä®ÂèëÁé∞Êú∫Âà∂</h1>
<p>Âì®ÂÖµ‰∫íÁõ∏‰πãÈó¥ÁöÑÂèëÁé∞ÔºåÊòØÈÄöËøá Redis ÁöÑ <code>pub/sub</code> Á≥ªÁªüÂÆûÁé∞ÁöÑÔºåÊØè‰∏™Âì®ÂÖµÈÉΩ‰ºöÂæÄ <code>__sentinel__:hello</code> Ëøô‰∏™ channel ÈáåÂèëÈÄÅ‰∏Ä‰∏™Ê∂àÊÅØÔºåËøôÊó∂ÂÄôÊâÄÊúâÂÖ∂‰ªñÂì®ÂÖµÈÉΩÂèØ‰ª•Ê∂àË¥πÂà∞Ëøô‰∏™Ê∂àÊÅØÔºåÂπ∂ÊÑüÁü•Âà∞ÂÖ∂‰ªñÁöÑÂì®ÂÖµÁöÑÂ≠òÂú®„ÄÇ</p>
<p>ÊØèÈöî‰∏§ÁßíÈíüÔºåÊØè‰∏™Âì®ÂÖµÈÉΩ‰ºöÂæÄËá™Â∑±ÁõëÊéßÁöÑÊüê‰∏™ master+slaves ÂØπÂ∫îÁöÑ <code>__sentinel__:hello</code> channel Èáå<strong>ÂèëÈÄÅ‰∏Ä‰∏™Ê∂àÊÅØ</strong>ÔºåÂÜÖÂÆπÊòØËá™Â∑±ÁöÑ host„ÄÅip Âíå runid ËøòÊúâÂØπËøô‰∏™ master ÁöÑÁõëÊéßÈÖçÁΩÆ„ÄÇ</p>
<p>ÊØè‰∏™Âì®ÂÖµ‰πü‰ºöÂéª<strong>ÁõëÂê¨</strong>Ëá™Â∑±ÁõëÊéßÁöÑÊØè‰∏™ master+slaves ÂØπÂ∫îÁöÑ <code>__sentinel__:hello</code> channelÔºåÁÑ∂ÂêéÂéªÊÑüÁü•Âà∞ÂêåÊ†∑Âú®ÁõëÂê¨Ëøô‰∏™ master+slaves ÁöÑÂÖ∂‰ªñÂì®ÂÖµÁöÑÂ≠òÂú®„ÄÇ</p>
<p>ÊØè‰∏™Âì®ÂÖµËøò‰ºöË∑üÂÖ∂‰ªñÂì®ÂÖµ‰∫§Êç¢ÂØπ <code>master</code> ÁöÑÁõëÊéßÈÖçÁΩÆÔºå‰∫íÁõ∏ËøõË°åÁõëÊéßÈÖçÁΩÆÁöÑÂêåÊ≠•„ÄÇ</p>
<h2 id="101-slave-ÈÖçÁΩÆÁöÑËá™Âä®Á∫†Ê≠£"><a class="markdownIt-Anchor" href="#101-slave-ÈÖçÁΩÆÁöÑËá™Âä®Á∫†Ê≠£"></a> 10.1: slave ÈÖçÁΩÆÁöÑËá™Âä®Á∫†Ê≠£</h2>
<p>Âì®ÂÖµ‰ºöË¥üË¥£Ëá™Âä®Á∫†Ê≠£ slave ÁöÑ‰∏Ä‰∫õÈÖçÁΩÆÔºåÊØîÂ¶Ç slave Â¶ÇÊûúË¶ÅÊàê‰∏∫ÊΩúÂú®ÁöÑ master ÂÄôÈÄâ‰∫∫ÔºåÂì®ÂÖµ‰ºöÁ°Æ‰øù slave Â§çÂà∂Áé∞Êúâ master ÁöÑÊï∞ÊçÆÔºõÂ¶ÇÊûú slave ËøûÊé•Âà∞‰∫Ü‰∏Ä‰∏™ÈîôËØØÁöÑ master ‰∏äÔºåÊØîÂ¶ÇÊïÖÈöúËΩ¨Áßª‰πãÂêéÔºåÈÇ£‰πàÂì®ÂÖµ‰ºöÁ°Æ‰øùÂÆÉ‰ª¨ËøûÊé•Âà∞Ê≠£Á°ÆÁöÑ master ‰∏ä„ÄÇ</p>
<h2 id="102-slave-master-ÈÄâ‰∏æÁÆóÊ≥ï"><a class="markdownIt-Anchor" href="#102-slave-master-ÈÄâ‰∏æÁÆóÊ≥ï"></a> 10.2: slave-&gt;master ÈÄâ‰∏æÁÆóÊ≥ï</h2>
<p>Â¶ÇÊûú‰∏Ä‰∏™ master Ë¢´ËÆ§‰∏∫ odown ‰∫ÜÔºåËÄå‰∏î majority Êï∞ÈáèÁöÑÂì®ÂÖµÈÉΩÂÖÅËÆ∏‰∏ªÂ§áÂàáÊç¢ÔºåÈÇ£‰πàÊüê‰∏™Âì®ÂÖµÂ∞±‰ºöÊâßË°å‰∏ªÂ§áÂàáÊç¢Êìç‰ΩúÔºåÊ≠§Êó∂È¶ñÂÖàË¶ÅÈÄâ‰∏æ‰∏Ä‰∏™ slave Êù•Ôºå‰ºöËÄÉËôë slave ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØÔºö</p>
<ul>
<li>Ë∑ü master Êñ≠ÂºÄËøûÊé•ÁöÑÊó∂Èïø</li>
<li>slave ‰ºòÂÖàÁ∫ß</li>
<li>Â§çÂà∂ offset</li>
<li>run id</li>
</ul>
<p>Â¶ÇÊûú‰∏Ä‰∏™ slave Ë∑ü master Êñ≠ÂºÄËøûÊé•ÁöÑÊó∂Èó¥Â∑≤ÁªèË∂ÖËøá‰∫Ü <code>down-after-milliseconds</code> ÁöÑ 10 ÂÄçÔºåÂ§ñÂä† master ÂÆïÊú∫ÁöÑÊó∂ÈïøÔºåÈÇ£‰πà slave Â∞±Ë¢´ËÆ§‰∏∫‰∏çÈÄÇÂêàÈÄâ‰∏æ‰∏∫ master„ÄÇ</p>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">(down-<span class="hljs-keyword">after</span>-<span class="hljs-built_in">milliseconds</span> * <span class="hljs-number">10</span>) + milliseconds_since_master_is_in_SDOWN_stateCopy <span class="hljs-built_in">to</span> clipboardErrorCopied<br></code></pre></td></tr></tbody></table></figure>
<p>Êé•‰∏ãÊù•‰ºöÂØπ slave ËøõË°åÊéíÂ∫èÔºö</p>
<ul>
<li>ÊåâÁÖß slave ‰ºòÂÖàÁ∫ßËøõË°åÊéíÂ∫èÔºåslave priority Ë∂ä‰ΩéÔºå‰ºòÂÖàÁ∫ßÂ∞±Ë∂äÈ´ò„ÄÇ</li>
<li>Â¶ÇÊûú slave priority Áõ∏ÂêåÔºåÈÇ£‰πàÁúã replica offsetÔºåÂì™‰∏™ slave Â§çÂà∂‰∫ÜË∂äÂ§öÁöÑÊï∞ÊçÆÔºåoffset Ë∂äÈù†ÂêéÔºå‰ºòÂÖàÁ∫ßÂ∞±Ë∂äÈ´ò„ÄÇ</li>
<li>Â¶ÇÊûú‰∏äÈù¢‰∏§‰∏™Êù°‰ª∂ÈÉΩÁõ∏ÂêåÔºåÈÇ£‰πàÈÄâÊã©‰∏Ä‰∏™ run id ÊØîËæÉÂ∞èÁöÑÈÇ£‰∏™ slave„ÄÇ</li>
</ul>
<h2 id="103-quorum-Âíå-majority"><a class="markdownIt-Anchor" href="#103-quorum-Âíå-majority"></a> 10.3: quorum Âíå majority</h2>
<p>ÊØèÊ¨°‰∏Ä‰∏™Âì®ÂÖµË¶ÅÂÅö‰∏ªÂ§áÂàáÊç¢ÔºåÈ¶ñÂÖàÈúÄË¶Å quorum Êï∞ÈáèÁöÑÂì®ÂÖµËÆ§‰∏∫ odownÔºåÁÑ∂ÂêéÈÄâ‰∏æÂá∫‰∏Ä‰∏™Âì®ÂÖµÊù•ÂÅöÂàáÊç¢ÔºåËøô‰∏™Âì®ÂÖµËøòÈúÄË¶ÅÂæóÂà∞ majority Âì®ÂÖµÁöÑÊéàÊùÉÔºåÊâçËÉΩÊ≠£ÂºèÊâßË°åÂàáÊç¢„ÄÇ</p>
<p>Â¶ÇÊûú quorum &lt; majorityÔºåÊØîÂ¶Ç 5 ‰∏™Âì®ÂÖµÔºåmajority Â∞±ÊòØ 3Ôºåquorum ËÆæÁΩÆ‰∏∫ 2ÔºåÈÇ£‰πàÂ∞± 3 ‰∏™Âì®ÂÖµÊéàÊùÉÂ∞±ÂèØ‰ª•ÊâßË°åÂàáÊç¢„ÄÇ</p>
<p>‰ΩÜÊòØÂ¶ÇÊûú quorum &gt;= majorityÔºåÈÇ£‰πàÂøÖÈ°ª quorum Êï∞ÈáèÁöÑÂì®ÂÖµÈÉΩÊéàÊùÉÔºåÊØîÂ¶Ç 5 ‰∏™Âì®ÂÖµÔºåquorum ÊòØ 5ÔºåÈÇ£‰πàÂøÖÈ°ª 5 ‰∏™Âì®ÂÖµÈÉΩÂêåÊÑèÊéàÊùÉÔºåÊâçËÉΩÊâßË°åÂàáÊç¢„ÄÇ</p>
<h1 id="11-configuration-epoch"><a class="markdownIt-Anchor" href="#11-configuration-epoch"></a> 11: configuration epoch</h1>
<p>Âì®ÂÖµ‰ºöÂØπ‰∏ÄÂ•ó Redis master+slaves ËøõË°åÁõëÊéßÔºåÊúâÁõ∏Â∫îÁöÑÁõëÊéßÁöÑÈÖçÁΩÆ„ÄÇ</p>
<p>ÊâßË°åÂàáÊç¢ÁöÑÈÇ£‰∏™Âì®ÂÖµÔºå‰ºö‰ªéË¶ÅÂàáÊç¢Âà∞ÁöÑÊñ∞ masterÔºàsalve-&gt;masterÔºâÈÇ£ÈáåÂæóÂà∞‰∏Ä‰∏™ configuration epochÔºåËøôÂ∞±ÊòØ‰∏Ä‰∏™ version Âè∑ÔºåÊØèÊ¨°ÂàáÊç¢ÁöÑ version Âè∑ÈÉΩÂøÖÈ°ªÊòØÂîØ‰∏ÄÁöÑ„ÄÇ</p>
<p>Â¶ÇÊûúÁ¨¨‰∏Ä‰∏™ÈÄâ‰∏æÂá∫ÁöÑÂì®ÂÖµÂàáÊç¢Â§±Ë¥•‰∫ÜÔºåÈÇ£‰πàÂÖ∂‰ªñÂì®ÂÖµÔºå‰ºöÁ≠âÂæÖ failover-timeout Êó∂Èó¥ÔºåÁÑ∂ÂêéÊé•ÊõøÁªßÁª≠ÊâßË°åÂàáÊç¢ÔºåÊ≠§Êó∂‰ºöÈáçÊñ∞Ëé∑Âèñ‰∏Ä‰∏™Êñ∞ÁöÑ configuration epochÔºå‰Ωú‰∏∫Êñ∞ÁöÑ version Âè∑„ÄÇ</p>
<h1 id="12-configuration-‰º†Êí≠"><a class="markdownIt-Anchor" href="#12-configuration-‰º†Êí≠"></a> 12: configuration ‰º†Êí≠</h1>
<p>Âì®ÂÖµÂÆåÊàêÂàáÊç¢‰πãÂêéÔºå‰ºöÂú®Ëá™Â∑±Êú¨Âú∞Êõ¥Êñ∞ÁîüÊàêÊúÄÊñ∞ÁöÑ master ÈÖçÁΩÆÔºåÁÑ∂ÂêéÂêåÊ≠•ÁªôÂÖ∂‰ªñÁöÑÂì®ÂÖµÔºåÂ∞±ÊòØÈÄöËøá‰πãÂâçËØ¥ÁöÑ <code>pub/sub</code> Ê∂àÊÅØÊú∫Âà∂„ÄÇ</p>
<p>ËøôÈáå‰πãÂâçÁöÑ version Âè∑Â∞±ÂæàÈáçË¶Å‰∫ÜÔºåÂõ†‰∏∫ÂêÑÁßçÊ∂àÊÅØÈÉΩÊòØÈÄöËøá‰∏Ä‰∏™ channel ÂéªÂèëÂ∏ÉÂíåÁõëÂê¨ÁöÑÔºåÊâÄ‰ª•‰∏Ä‰∏™Âì®ÂÖµÂÆåÊàê‰∏ÄÊ¨°Êñ∞ÁöÑÂàáÊç¢‰πãÂêéÔºåÊñ∞ÁöÑ master ÈÖçÁΩÆÊòØË∑üÁùÄÊñ∞ÁöÑ version Âè∑ÁöÑ„ÄÇÂÖ∂‰ªñÁöÑÂì®ÂÖµÈÉΩÊòØÊ†πÊçÆÁâàÊú¨Âè∑ÁöÑÂ§ßÂ∞èÊù•Êõ¥Êñ∞Ëá™Â∑±ÁöÑ master ÈÖçÁΩÆÁöÑ„ÄÇ</p>
<h1 id="13-27-redisÈõÜÁæ§Ê®°ÂºèÁöÑÂ∑•‰ΩúÂéüÁêÜÊòØ‰ªÄ‰πà"><a class="markdownIt-Anchor" href="#13-27-redisÈõÜÁæ§Ê®°ÂºèÁöÑÂ∑•‰ΩúÂéüÁêÜÊòØ‰ªÄ‰πà"></a> 13: 27„ÄÅRedisÈõÜÁæ§Ê®°ÂºèÁöÑÂ∑•‰ΩúÂéüÁêÜÊòØ‰ªÄ‰πàÔºü</h1>
<h2 id="131-Âü∫Êú¨ÈÄö‰ø°ÂéüÁêÜ"><a class="markdownIt-Anchor" href="#131-Âü∫Êú¨ÈÄö‰ø°ÂéüÁêÜ"></a> 13.1: Âü∫Êú¨ÈÄö‰ø°ÂéüÁêÜ</h2>
<p>ÈõÜÁæ§ÂÖÉÊï∞ÊçÆÁöÑÁª¥Êä§Êúâ‰∏§ÁßçÊñπÂºèÔºöÈõÜ‰∏≠Âºè„ÄÅGossip ÂçèËÆÆ„ÄÇRedis cluster ËäÇÁÇπÈó¥ÈááÁî® gossip ÂçèËÆÆËøõË°åÈÄö‰ø°„ÄÇ</p>
<p><strong>ÈõÜ‰∏≠Âºè</strong>ÊòØÂ∞ÜÈõÜÁæ§ÂÖÉÊï∞ÊçÆÔºàËäÇÁÇπ‰ø°ÊÅØ„ÄÅÊïÖÈöúÁ≠âÁ≠âÔºâÈõÜ‰∏≠Â≠òÂÇ®Âú®Êüê‰∏™ËäÇÁÇπ‰∏ä„ÄÇÈõÜ‰∏≠ÂºèÂÖÉÊï∞ÊçÆÈõÜ‰∏≠Â≠òÂÇ®ÁöÑ‰∏Ä‰∏™ÂÖ∏Âûã‰ª£Ë°®ÔºåÂ∞±ÊòØÂ§ßÊï∞ÊçÆÈ¢ÜÂüüÁöÑ <code>storm</code> „ÄÇÂÆÉÊòØÂàÜÂ∏ÉÂºèÁöÑÂ§ßÊï∞ÊçÆÂÆûÊó∂ËÆ°ÁÆóÂºïÊìéÔºåÊòØÈõÜ‰∏≠ÂºèÁöÑÂÖÉÊï∞ÊçÆÂ≠òÂÇ®ÁöÑÁªìÊûÑÔºåÂ∫ïÂ±ÇÂü∫‰∫é zookeeperÔºàÂàÜÂ∏ÉÂºèÂçèË∞ÉÁöÑ‰∏≠Èó¥‰ª∂ÔºâÂØπÊâÄÊúâÂÖÉÊï∞ÊçÆËøõË°åÂ≠òÂÇ®Áª¥Êä§„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301899.png" srcset="/img/loading.gif" lazyload alt="zookeeper-centralized-storage"></p>
<p>Redis Áª¥Êä§ÈõÜÁæ§ÂÖÉÊï∞ÊçÆÈááÁî®Âè¶‰∏Ä‰∏™ÊñπÂºèÔºå <code>gossip</code> ÂçèËÆÆÔºåÊâÄÊúâËäÇÁÇπÈÉΩÊåÅÊúâ‰∏Ä‰ªΩÂÖÉÊï∞ÊçÆÔºå‰∏çÂêåÁöÑËäÇÁÇπÂ¶ÇÊûúÂá∫Áé∞‰∫ÜÂÖÉÊï∞ÊçÆÁöÑÂèòÊõ¥ÔºåÂ∞±‰∏çÊñ≠Â∞ÜÂÖÉÊï∞ÊçÆÂèëÈÄÅÁªôÂÖ∂ÂÆÉÁöÑËäÇÁÇπÔºåËÆ©ÂÖ∂ÂÆÉËäÇÁÇπ‰πüËøõË°åÂÖÉÊï∞ÊçÆÁöÑÂèòÊõ¥„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301027.png" srcset="/img/loading.gif" lazyload alt="Redis-gossip"></p>
<p><strong>ÈõÜ‰∏≠Âºè</strong>ÁöÑ<strong>Â•ΩÂ§Ñ</strong>Âú®‰∫éÔºåÂÖÉÊï∞ÊçÆÁöÑËØªÂèñÂíåÊõ¥Êñ∞ÔºåÊó∂ÊïàÊÄßÈùûÂ∏∏Â•ΩÔºå‰∏ÄÊó¶ÂÖÉÊï∞ÊçÆÂá∫Áé∞‰∫ÜÂèòÊõ¥ÔºåÂ∞±Á´ãÂç≥Êõ¥Êñ∞Âà∞ÈõÜ‰∏≠ÂºèÁöÑÂ≠òÂÇ®‰∏≠ÔºåÂÖ∂ÂÆÉËäÇÁÇπËØªÂèñÁöÑÊó∂ÂÄôÂ∞±ÂèØ‰ª•ÊÑüÁü•Âà∞Ôºõ<strong>‰∏çÂ•Ω</strong>Âú®‰∫éÔºåÊâÄÊúâÁöÑÂÖÉÊï∞ÊçÆÁöÑÊõ¥Êñ∞ÂéãÂäõÂÖ®ÈÉ®ÈõÜ‰∏≠Âú®‰∏Ä‰∏™Âú∞ÊñπÔºåÂèØËÉΩ‰ºöÂØºËá¥ÂÖÉÊï∞ÊçÆÁöÑÂ≠òÂÇ®ÊúâÂéãÂäõ„ÄÇ</p>
<p>gossip Â•ΩÂ§ÑÂú®‰∫éÔºåÂÖÉÊï∞ÊçÆÁöÑÊõ¥Êñ∞ÊØîËæÉÂàÜÊï£Ôºå‰∏çÊòØÈõÜ‰∏≠Âú®‰∏Ä‰∏™Âú∞ÊñπÔºåÊõ¥Êñ∞ËØ∑Ê±Ç‰ºöÈôÜÈôÜÁª≠Áª≠ÊâìÂà∞ÊâÄÊúâËäÇÁÇπ‰∏äÂéªÊõ¥Êñ∞ÔºåÈôç‰Ωé‰∫ÜÂéãÂäõÔºõ‰∏çÂ•ΩÂú®‰∫éÔºåÂÖÉÊï∞ÊçÆÁöÑÊõ¥Êñ∞ÊúâÂª∂Êó∂ÔºåÂèØËÉΩÂØºËá¥ÈõÜÁæ§‰∏≠ÁöÑ‰∏Ä‰∫õÊìç‰Ωú‰ºöÊúâ‰∏Ä‰∫õÊªûÂêé„ÄÇ</p>
<ul>
<li>10000 Á´ØÂè£ÔºöÊØè‰∏™ËäÇÁÇπÈÉΩÊúâ‰∏Ä‰∏™‰∏ìÈó®Áî®‰∫éËäÇÁÇπÈó¥ÈÄö‰ø°ÁöÑÁ´ØÂè£ÔºåÂ∞±ÊòØËá™Â∑±Êèê‰æõÊúçÂä°ÁöÑÁ´ØÂè£Âè∑+10000ÔºåÊØîÂ¶Ç 7001ÔºåÈÇ£‰πàÁî®‰∫éËäÇÁÇπÈó¥ÈÄö‰ø°ÁöÑÂ∞±ÊòØ 17001 Á´ØÂè£„ÄÇÊØè‰∏™ËäÇÁÇπÊØèÈöî‰∏ÄÊÆµÊó∂Èó¥ÈÉΩ‰ºöÂæÄÂè¶Â§ñÂá†‰∏™ËäÇÁÇπÂèëÈÄÅ <code>ping</code> Ê∂àÊÅØÔºåÂêåÊó∂ÂÖ∂ÂÆÉÂá†‰∏™ËäÇÁÇπÊé•Êî∂Âà∞ <code>ping</code> ‰πãÂêéËøîÂõû <code>pong</code> „ÄÇ</li>
<li>‰∫§Êç¢ÁöÑ‰ø°ÊÅØÔºö‰ø°ÊÅØÂåÖÊã¨ÊïÖÈöú‰ø°ÊÅØÔºåËäÇÁÇπÁöÑÂ¢ûÂä†ÂíåÂà†Èô§Ôºåhash slot ‰ø°ÊÅØÁ≠âÁ≠â„ÄÇ</li>
</ul>
<h2 id="132-gossip-ÂçèËÆÆ"><a class="markdownIt-Anchor" href="#132-gossip-ÂçèËÆÆ"></a> 13.2: gossip ÂçèËÆÆ</h2>
<p>gossip ÂçèËÆÆÂåÖÂê´Â§öÁßçÊ∂àÊÅØÔºåÂåÖÂê´ <code>ping</code> , <code>pong</code> , <code>meet</code> , <code>fail</code> Á≠âÁ≠â„ÄÇ</p>
<ul>
<li>meetÔºöÊüê‰∏™ËäÇÁÇπÂèëÈÄÅ meet ÁªôÊñ∞Âä†ÂÖ•ÁöÑËäÇÁÇπÔºåËÆ©Êñ∞ËäÇÁÇπÂä†ÂÖ•ÈõÜÁæ§‰∏≠ÔºåÁÑ∂ÂêéÊñ∞ËäÇÁÇπÂ∞±‰ºöÂºÄÂßã‰∏éÂÖ∂ÂÆÉËäÇÁÇπËøõË°åÈÄö‰ø°„ÄÇ</li>
</ul>
<figure class="highlight smali"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">Redis-trib.rb<span class="hljs-built_in"> add-nodeCopy </span>to clipboardErrorCopied<br></code></pre></td></tr></tbody></table></figure>
<p>ÂÖ∂ÂÆûÂÜÖÈÉ®Â∞±ÊòØÂèëÈÄÅ‰∫Ü‰∏Ä‰∏™ gossip meet Ê∂àÊÅØÁªôÊñ∞Âä†ÂÖ•ÁöÑËäÇÁÇπÔºåÈÄöÁü•ÈÇ£‰∏™ËäÇÁÇπÂéªÂä†ÂÖ•Êàë‰ª¨ÁöÑÈõÜÁæ§„ÄÇ</p>
<ul>
<li>pingÔºöÊØè‰∏™ËäÇÁÇπÈÉΩ‰ºöÈ¢ëÁπÅÁªôÂÖ∂ÂÆÉËäÇÁÇπÂèëÈÄÅ pingÔºåÂÖ∂‰∏≠ÂåÖÂê´Ëá™Â∑±ÁöÑÁä∂ÊÄÅËøòÊúâËá™Â∑±Áª¥Êä§ÁöÑÈõÜÁæ§ÂÖÉÊï∞ÊçÆÔºå‰∫íÁõ∏ÈÄöËøá ping ‰∫§Êç¢ÂÖÉÊï∞ÊçÆ„ÄÇ</li>
<li>pongÔºöËøîÂõû ping Âíå meetÔºåÂåÖÂê´Ëá™Â∑±ÁöÑÁä∂ÊÄÅÂíåÂÖ∂ÂÆÉ‰ø°ÊÅØÔºå‰πüÁî®‰∫é‰ø°ÊÅØÂπøÊí≠ÂíåÊõ¥Êñ∞„ÄÇ</li>
<li>failÔºöÊüê‰∏™ËäÇÁÇπÂà§Êñ≠Âè¶‰∏Ä‰∏™ËäÇÁÇπ fail ‰πãÂêéÔºåÂ∞±ÂèëÈÄÅ fail ÁªôÂÖ∂ÂÆÉËäÇÁÇπÔºåÈÄöÁü•ÂÖ∂ÂÆÉËäÇÁÇπËØ¥ÔºåÊüê‰∏™ËäÇÁÇπÂÆïÊú∫Âï¶„ÄÇ</li>
</ul>
<h2 id="133-ping-Ê∂àÊÅØÊ∑±ÂÖ•"><a class="markdownIt-Anchor" href="#133-ping-Ê∂àÊÅØÊ∑±ÂÖ•"></a> 13.3: ping Ê∂àÊÅØÊ∑±ÂÖ•</h2>
<p>ping Êó∂Ë¶ÅÊê∫Â∏¶‰∏Ä‰∫õÂÖÉÊï∞ÊçÆÔºåÂ¶ÇÊûúÂæàÈ¢ëÁπÅÔºåÂèØËÉΩ‰ºöÂä†ÈáçÁΩëÁªúË¥üÊãÖ„ÄÇ</p>
<p>ÊØè‰∏™ËäÇÁÇπÊØèÁßí‰ºöÊâßË°å 10 Ê¨° pingÔºåÊØèÊ¨°‰ºöÈÄâÊã© 5 ‰∏™ÊúÄ‰πÖÊ≤°ÊúâÈÄö‰ø°ÁöÑÂÖ∂ÂÆÉËäÇÁÇπ„ÄÇÂΩìÁÑ∂Â¶ÇÊûúÂèëÁé∞Êüê‰∏™ËäÇÁÇπÈÄö‰ø°Âª∂Êó∂ËææÂà∞‰∫Ü <code>cluster_node_timeout / 2</code> ÔºåÈÇ£‰πàÁ´ãÂç≥ÂèëÈÄÅ pingÔºåÈÅøÂÖçÊï∞ÊçÆ‰∫§Êç¢Âª∂Êó∂ËøáÈïøÔºåËêΩÂêéÁöÑÊó∂Èó¥Â§™Èïø‰∫Ü„ÄÇÊØîÂ¶ÇËØ¥Ôºå‰∏§‰∏™ËäÇÁÇπ‰πãÈó¥ÈÉΩ 10 ÂàÜÈíüÊ≤°Êúâ‰∫§Êç¢Êï∞ÊçÆ‰∫ÜÔºåÈÇ£‰πàÊï¥‰∏™ÈõÜÁæ§Â§Ñ‰∫é‰∏•ÈáçÁöÑÂÖÉÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºåÂ∞±‰ºöÊúâÈóÆÈ¢ò„ÄÇÊâÄ‰ª• <code>cluster_node_timeout</code> ÂèØ‰ª•Ë∞ÉËäÇÔºåÂ¶ÇÊûúË∞ÉÂæóÊØîËæÉÂ§ßÔºåÈÇ£‰πà‰ºöÈôç‰Ωé ping ÁöÑÈ¢ëÁéá„ÄÇ</p>
<p>ÊØèÊ¨° pingÔºå‰ºöÂ∏¶‰∏äËá™Â∑±ËäÇÁÇπÁöÑ‰ø°ÊÅØÔºåËøòÊúâÂ∞±ÊòØÂ∏¶‰∏ä 1/10 ÂÖ∂ÂÆÉËäÇÁÇπÁöÑ‰ø°ÊÅØÔºåÂèëÈÄÅÂá∫ÂéªÔºåËøõË°å‰∫§Êç¢„ÄÇËá≥Â∞ëÂåÖÂê´ <code>3</code> ‰∏™ÂÖ∂ÂÆÉËäÇÁÇπÁöÑ‰ø°ÊÅØÔºåÊúÄÂ§öÂåÖÂê´ <code>ÊÄªËäÇÁÇπÊï∞Âáè 2</code> ‰∏™ÂÖ∂ÂÆÉËäÇÁÇπÁöÑ‰ø°ÊÅØ„ÄÇ</p>
<h2 id="134-ÂàÜÂ∏ÉÂºèÂØªÂùÄÁÆóÊ≥ï"><a class="markdownIt-Anchor" href="#134-ÂàÜÂ∏ÉÂºèÂØªÂùÄÁÆóÊ≥ï"></a> 13.4: ÂàÜÂ∏ÉÂºèÂØªÂùÄÁÆóÊ≥ï</h2>
<ul>
<li>hash ÁÆóÊ≥ïÔºàÂ§ßÈáèÁºìÂ≠òÈáçÂª∫Ôºâ</li>
<li>‰∏ÄËá¥ÊÄß hash ÁÆóÊ≥ïÔºàËá™Âä®ÁºìÂ≠òËøÅÁßªÔºâ+ ËôöÊãüËäÇÁÇπÔºàËá™Âä®Ë¥üËΩΩÂùáË°°Ôºâ</li>
<li>Redis cluster ÁöÑ hash slot ÁÆóÊ≥ï</li>
</ul>
<h2 id="135-hash-ÁÆóÊ≥ï"><a class="markdownIt-Anchor" href="#135-hash-ÁÆóÊ≥ï"></a> 13.5: hash ÁÆóÊ≥ï</h2>
<p>Êù•‰∫Ü‰∏Ä‰∏™ keyÔºåÈ¶ñÂÖàËÆ°ÁÆó hash ÂÄºÔºåÁÑ∂ÂêéÂØπËäÇÁÇπÊï∞ÂèñÊ®°„ÄÇÁÑ∂ÂêéÊâìÂú®‰∏çÂêåÁöÑ master ËäÇÁÇπ‰∏ä„ÄÇ‰∏ÄÊó¶Êüê‰∏Ä‰∏™ master ËäÇÁÇπÂÆïÊú∫ÔºåÊâÄÊúâËØ∑Ê±ÇËøáÊù•ÔºåÈÉΩ‰ºöÂü∫‰∫éÊúÄÊñ∞ÁöÑÂâ©‰Ωô master ËäÇÁÇπÊï∞ÂéªÂèñÊ®°ÔºåÂ∞ùËØïÂéªÂèñÊï∞ÊçÆ„ÄÇËøô‰ºöÂØºËá¥<strong>Â§ßÈÉ®ÂàÜÁöÑËØ∑Ê±ÇËøáÊù•ÔºåÂÖ®ÈÉ®Êó†Ê≥ïÊãøÂà∞ÊúâÊïàÁöÑÁºìÂ≠ò</strong>ÔºåÂØºËá¥Â§ßÈáèÁöÑÊµÅÈáèÊ∂åÂÖ•Êï∞ÊçÆÂ∫ì„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301343.png" srcset="/img/loading.gif" lazyload alt="hash"></p>
<h2 id="136-‰∏ÄËá¥ÊÄß-hash-ÁÆóÊ≥ï"><a class="markdownIt-Anchor" href="#136-‰∏ÄËá¥ÊÄß-hash-ÁÆóÊ≥ï"></a> 13.6: ‰∏ÄËá¥ÊÄß hash ÁÆóÊ≥ï</h2>
<p>‰∏ÄËá¥ÊÄß hash ÁÆóÊ≥ïÂ∞ÜÊï¥‰∏™ hash ÂÄºÁ©∫Èó¥ÁªÑÁªáÊàê‰∏Ä‰∏™ËôöÊãüÁöÑÂúÜÁéØÔºåÊï¥‰∏™Á©∫Èó¥ÊåâÈ°∫Êó∂ÈíàÊñπÂêëÁªÑÁªáÔºå‰∏ã‰∏ÄÊ≠•Â∞ÜÂêÑ‰∏™ master ËäÇÁÇπÔºà‰ΩøÁî®ÊúçÂä°Âô®ÁöÑ ip Êàñ‰∏ªÊú∫ÂêçÔºâËøõË°å hash„ÄÇËøôÊ†∑Â∞±ËÉΩÁ°ÆÂÆöÊØè‰∏™ËäÇÁÇπÂú®ÂÖ∂ÂìàÂ∏åÁéØ‰∏äÁöÑ‰ΩçÁΩÆ„ÄÇ</p>
<p>Êù•‰∫Ü‰∏Ä‰∏™ keyÔºåÈ¶ñÂÖàËÆ°ÁÆó hash ÂÄºÔºåÂπ∂Á°ÆÂÆöÊ≠§Êï∞ÊçÆÂú®ÁéØ‰∏äÁöÑ‰ΩçÁΩÆÔºå‰ªéÊ≠§‰ΩçÁΩÆÊ≤øÁéØ<strong>È°∫Êó∂Èíà‚ÄúË°åËµ∞‚Äù</strong>ÔºåÈÅáÂà∞ÁöÑÁ¨¨‰∏Ä‰∏™ master ËäÇÁÇπÂ∞±ÊòØ key ÊâÄÂú®‰ΩçÁΩÆ„ÄÇ</p>
<p>Âú®‰∏ÄËá¥ÊÄßÂìàÂ∏åÁÆóÊ≥ï‰∏≠ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ËäÇÁÇπÊåÇ‰∫ÜÔºåÂèóÂΩ±ÂìçÁöÑÊï∞ÊçÆ‰ªÖ‰ªÖÊòØÊ≠§ËäÇÁÇπÂà∞ÁéØÁ©∫Èó¥Ââç‰∏Ä‰∏™ËäÇÁÇπÔºàÊ≤øÁùÄÈÄÜÊó∂ÈíàÊñπÂêëË°åËµ∞ÈÅáÂà∞ÁöÑÁ¨¨‰∏Ä‰∏™ËäÇÁÇπÔºâ‰πãÈó¥ÁöÑÊï∞ÊçÆÔºåÂÖ∂ÂÆÉ‰∏çÂèóÂΩ±Âìç„ÄÇÂ¢ûÂä†‰∏Ä‰∏™ËäÇÁÇπ‰πüÂêåÁêÜ„ÄÇ</p>
<p>ÁáÉÈπÖÔºå‰∏ÄËá¥ÊÄßÂìàÂ∏åÁÆóÊ≥ïÂú®ËäÇÁÇπÂ§™Â∞ëÊó∂ÔºåÂÆπÊòìÂõ†‰∏∫ËäÇÁÇπÂàÜÂ∏É‰∏çÂùáÂåÄËÄåÈÄ†Êàê<strong>ÁºìÂ≠òÁÉ≠ÁÇπ</strong>ÁöÑÈóÆÈ¢ò„ÄÇ‰∏∫‰∫ÜËß£ÂÜ≥ËøôÁßçÁÉ≠ÁÇπÈóÆÈ¢òÔºå‰∏ÄËá¥ÊÄß hash ÁÆóÊ≥ïÂºïÂÖ•‰∫ÜËôöÊãüËäÇÁÇπÊú∫Âà∂ÔºåÂç≥ÂØπÊØè‰∏Ä‰∏™ËäÇÁÇπËÆ°ÁÆóÂ§ö‰∏™ hashÔºåÊØè‰∏™ËÆ°ÁÆóÁªìÊûú‰ΩçÁΩÆÈÉΩÊîæÁΩÆ‰∏Ä‰∏™ËôöÊãüËäÇÁÇπ„ÄÇËøôÊ†∑Â∞±ÂÆûÁé∞‰∫ÜÊï∞ÊçÆÁöÑÂùáÂåÄÂàÜÂ∏ÉÔºåË¥üËΩΩÂùáË°°„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301991.png" srcset="/img/loading.gif" lazyload alt="consistent-hashing-algorithm"></p>
<h2 id="137-redis-cluster-ÁöÑ-hash-slot-ÁÆóÊ≥ï"><a class="markdownIt-Anchor" href="#137-redis-cluster-ÁöÑ-hash-slot-ÁÆóÊ≥ï"></a> 13.7: Redis cluster ÁöÑ hash slot ÁÆóÊ≥ï</h2>
<p>Redis cluster ÊúâÂõ∫ÂÆöÁöÑ <code>16384</code> ‰∏™ hash slotÔºåÂØπÊØè‰∏™ <code>key</code> ËÆ°ÁÆó <code>CRC16</code> ÂÄºÔºåÁÑ∂ÂêéÂØπ <code>16384</code> ÂèñÊ®°ÔºåÂèØ‰ª•Ëé∑Âèñ key ÂØπÂ∫îÁöÑ hash slot„ÄÇ</p>
<p>Redis cluster ‰∏≠ÊØè‰∏™ master ÈÉΩ‰ºöÊåÅÊúâÈÉ®ÂàÜ slotÔºåÊØîÂ¶ÇÊúâ 3 ‰∏™ masterÔºåÈÇ£‰πàÂèØËÉΩÊØè‰∏™ master ÊåÅÊúâ 5000 Â§ö‰∏™ hash slot„ÄÇhash slot ËÆ© node ÁöÑÂ¢ûÂä†ÂíåÁßªÈô§ÂæàÁÆÄÂçïÔºåÂ¢ûÂä†‰∏Ä‰∏™ masterÔºåÂ∞±Â∞ÜÂÖ∂‰ªñ master ÁöÑ hash slot ÁßªÂä®ÈÉ®ÂàÜËøáÂéªÔºåÂáèÂ∞ë‰∏Ä‰∏™ masterÔºåÂ∞±Â∞ÜÂÆÉÁöÑ hash slot ÁßªÂä®Âà∞ÂÖ∂‰ªñ master ‰∏äÂéª„ÄÇÁßªÂä® hash slot ÁöÑÊàêÊú¨ÊòØÈùûÂ∏∏‰ΩéÁöÑ„ÄÇÂÆ¢Êà∑Á´ØÁöÑ apiÔºåÂèØ‰ª•ÂØπÊåáÂÆöÁöÑÊï∞ÊçÆÔºåËÆ©‰ªñ‰ª¨Ëµ∞Âêå‰∏Ä‰∏™ hash slotÔºåÈÄöËøá <code>hash tag</code> Êù•ÂÆûÁé∞„ÄÇ</p>
<p>‰ªª‰Ωï‰∏ÄÂè∞Êú∫Âô®ÂÆïÊú∫ÔºåÂè¶Â§ñ‰∏§‰∏™ËäÇÁÇπÔºå‰∏çÂΩ±ÂìçÁöÑ„ÄÇÂõ†‰∏∫ key ÊâæÁöÑÊòØ hash slotÔºå‰∏çÊòØÊú∫Âô®„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301481.png" srcset="/img/loading.gif" lazyload alt="hash-slot"></p>
<h2 id="138-redis-cluster-ÁöÑÈ´òÂèØÁî®‰∏é‰∏ªÂ§áÂàáÊç¢ÂéüÁêÜ"><a class="markdownIt-Anchor" href="#138-redis-cluster-ÁöÑÈ´òÂèØÁî®‰∏é‰∏ªÂ§áÂàáÊç¢ÂéüÁêÜ"></a> 13.8: Redis cluster ÁöÑÈ´òÂèØÁî®‰∏é‰∏ªÂ§áÂàáÊç¢ÂéüÁêÜ</h2>
<p>Redis cluster ÁöÑÈ´òÂèØÁî®ÁöÑÂéüÁêÜÔºåÂá†‰πéË∑üÂì®ÂÖµÊòØÁ±ª‰ººÁöÑ„ÄÇ</p>
<h2 id="139-Âà§Êñ≠ËäÇÁÇπÂÆïÊú∫"><a class="markdownIt-Anchor" href="#139-Âà§Êñ≠ËäÇÁÇπÂÆïÊú∫"></a> 13.9: Âà§Êñ≠ËäÇÁÇπÂÆïÊú∫</h2>
<p>Â¶ÇÊûú‰∏Ä‰∏™ËäÇÁÇπËÆ§‰∏∫Âè¶Â§ñ‰∏Ä‰∏™ËäÇÁÇπÂÆïÊú∫ÔºåÈÇ£‰πàÂ∞±ÊòØ <code>pfail</code> Ôºå<strong>‰∏ªËßÇÂÆïÊú∫</strong>„ÄÇÂ¶ÇÊûúÂ§ö‰∏™ËäÇÁÇπÈÉΩËÆ§‰∏∫Âè¶Â§ñ‰∏Ä‰∏™ËäÇÁÇπÂÆïÊú∫‰∫ÜÔºåÈÇ£‰πàÂ∞±ÊòØ <code>fail</code> Ôºå<strong>ÂÆ¢ËßÇÂÆïÊú∫</strong>ÔºåË∑üÂì®ÂÖµÁöÑÂéüÁêÜÂá†‰πé‰∏ÄÊ†∑ÔºåsdownÔºåodown„ÄÇ</p>
<p>Âú® <code>cluster-node-timeout</code> ÂÜÖÔºåÊüê‰∏™ËäÇÁÇπ‰∏ÄÁõ¥Ê≤°ÊúâËøîÂõû <code>pong</code> ÔºåÈÇ£‰πàÂ∞±Ë¢´ËÆ§‰∏∫ <code>pfail</code> „ÄÇ</p>
<p>Â¶ÇÊûú‰∏Ä‰∏™ËäÇÁÇπËÆ§‰∏∫Êüê‰∏™ËäÇÁÇπ <code>pfail</code> ‰∫ÜÔºåÈÇ£‰πà‰ºöÂú® <code>gossip ping</code> Ê∂àÊÅØ‰∏≠Ôºå <code>ping</code> ÁªôÂÖ∂‰ªñËäÇÁÇπÔºåÂ¶ÇÊûú<strong>Ë∂ÖËøáÂçäÊï∞</strong>ÁöÑËäÇÁÇπÈÉΩËÆ§‰∏∫ <code>pfail</code> ‰∫ÜÔºåÈÇ£‰πàÂ∞±‰ºöÂèòÊàê <code>fail</code> „ÄÇ</p>
<h2 id="1310-‰ªéËäÇÁÇπËøáÊª§"><a class="markdownIt-Anchor" href="#1310-‰ªéËäÇÁÇπËøáÊª§"></a> 13.10: ‰ªéËäÇÁÇπËøáÊª§</h2>
<p>ÂØπÂÆïÊú∫ÁöÑ master nodeÔºå‰ªéÂÖ∂ÊâÄÊúâÁöÑ slave node ‰∏≠ÔºåÈÄâÊã©‰∏Ä‰∏™ÂàáÊç¢Êàê master node„ÄÇ</p>
<p>Ê£ÄÊü•ÊØè‰∏™ slave node ‰∏é master node Êñ≠ÂºÄËøûÊé•ÁöÑÊó∂Èó¥ÔºåÂ¶ÇÊûúË∂ÖËøá‰∫Ü <code>cluster-node-timeout * cluster-slave-validity-factor</code> ÔºåÈÇ£‰πàÂ∞±<strong>Ê≤°ÊúâËµÑÊ†º</strong>ÂàáÊç¢Êàê <code>master</code> „ÄÇ</p>
<h2 id="1311-‰ªéËäÇÁÇπÈÄâ‰∏æ"><a class="markdownIt-Anchor" href="#1311-‰ªéËäÇÁÇπÈÄâ‰∏æ"></a> 13.11: ‰ªéËäÇÁÇπÈÄâ‰∏æ</h2>
<p>ÊØè‰∏™‰ªéËäÇÁÇπÔºåÈÉΩÊ†πÊçÆËá™Â∑±ÂØπ master Â§çÂà∂Êï∞ÊçÆÁöÑ offsetÔºåÊù•ËÆæÁΩÆ‰∏Ä‰∏™ÈÄâ‰∏æÊó∂Èó¥Ôºåoffset Ë∂äÂ§ßÔºàÂ§çÂà∂Êï∞ÊçÆË∂äÂ§öÔºâÁöÑ‰ªéËäÇÁÇπÔºåÈÄâ‰∏æÊó∂Èó¥Ë∂äÈù†ÂâçÔºå‰ºòÂÖàËøõË°åÈÄâ‰∏æ„ÄÇ</p>
<p>ÊâÄÊúâÁöÑ master node ÂºÄÂßã slave ÈÄâ‰∏æÊäïÁ•®ÔºåÁªôË¶ÅËøõË°åÈÄâ‰∏æÁöÑ slave ËøõË°åÊäïÁ•®ÔºåÂ¶ÇÊûúÂ§ßÈÉ®ÂàÜ master node <code>ÔºàN/2 + 1Ôºâ</code> ÈÉΩÊäïÁ•®Áªô‰∫ÜÊüê‰∏™‰ªéËäÇÁÇπÔºåÈÇ£‰πàÈÄâ‰∏æÈÄöËøáÔºåÈÇ£‰∏™‰ªéËäÇÁÇπÂèØ‰ª•ÂàáÊç¢Êàê master„ÄÇ</p>
<p>‰ªéËäÇÁÇπÊâßË°å‰∏ªÂ§áÂàáÊç¢Ôºå‰ªéËäÇÁÇπÂàáÊç¢‰∏∫‰∏ªËäÇÁÇπ„ÄÇ</p>
<h2 id="1312-‰∏éÂì®ÂÖµÊØîËæÉ"><a class="markdownIt-Anchor" href="#1312-‰∏éÂì®ÂÖµÊØîËæÉ"></a> 13.12: ‰∏éÂì®ÂÖµÊØîËæÉ</h2>
<p>Êï¥‰∏™ÊµÅÁ®ãË∑üÂì®ÂÖµÁõ∏ÊØîÔºåÈùûÂ∏∏Á±ª‰ººÔºåÊâÄ‰ª•ËØ¥ÔºåRedis cluster ÂäüËÉΩÂº∫Â§ßÔºåÁõ¥Êé•ÈõÜÊàê‰∫Ü replication Âíå sentinel ÁöÑÂäüËÉΩ„ÄÇ</p>
<h1 id="14-28-Â¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÁöÑÂèåÂÜô‰∏ÄËá¥ÊÄß"><a class="markdownIt-Anchor" href="#14-28-Â¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÁöÑÂèåÂÜô‰∏ÄËá¥ÊÄß"></a> 14: 28„ÄÅÂ¶Ç‰Ωï‰øùËØÅÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÁöÑÂèåÂÜô‰∏ÄËá¥ÊÄßÔºü</h1>
<h3 id="1411-‰Ω†Âè™Ë¶ÅÁî®ÁºìÂ≠òÂ∞±ÂèØËÉΩ‰ºöÊ∂âÂèäÂà∞ÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂ≠òÂÇ®ÂèåÂÜô‰Ω†Âè™Ë¶ÅÊòØÂèåÂÜôÂ∞±‰∏ÄÂÆö‰ºöÊúâÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÁöÑÈóÆÈ¢òÈÇ£‰πà‰Ω†Â¶Ç‰ΩïËß£ÂÜ≥‰∏ÄËá¥ÊÄßÈóÆÈ¢ò"><a class="markdownIt-Anchor" href="#1411-‰Ω†Âè™Ë¶ÅÁî®ÁºìÂ≠òÂ∞±ÂèØËÉΩ‰ºöÊ∂âÂèäÂà∞ÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂ≠òÂÇ®ÂèåÂÜô‰Ω†Âè™Ë¶ÅÊòØÂèåÂÜôÂ∞±‰∏ÄÂÆö‰ºöÊúâÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÁöÑÈóÆÈ¢òÈÇ£‰πà‰Ω†Â¶Ç‰ΩïËß£ÂÜ≥‰∏ÄËá¥ÊÄßÈóÆÈ¢ò"></a> 14.1.1: ‰Ω†Âè™Ë¶ÅÁî®ÁºìÂ≠òÔºåÂ∞±ÂèØËÉΩ‰ºöÊ∂âÂèäÂà∞ÁºìÂ≠ò‰∏éÊï∞ÊçÆÂ∫ìÂèåÂ≠òÂÇ®ÂèåÂÜôÔºå‰Ω†Âè™Ë¶ÅÊòØÂèåÂÜôÔºåÂ∞±‰∏ÄÂÆö‰ºöÊúâÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÁöÑÈóÆÈ¢òÔºåÈÇ£‰πà‰Ω†Â¶Ç‰ΩïËß£ÂÜ≥‰∏ÄËá¥ÊÄßÈóÆÈ¢òÔºü</h3>
<h2 id="142-cache-aside-pattern"><a class="markdownIt-Anchor" href="#142-cache-aside-pattern"></a> 14.2: Cache Aside Pattern</h2>
<p>ÊúÄÁªèÂÖ∏ÁöÑÁºìÂ≠ò+Êï∞ÊçÆÂ∫ìËØªÂÜôÁöÑÊ®°ÂºèÔºåÂ∞±ÊòØ Cache Aside Pattern„ÄÇ</p>
<ul>
<li>ËØªÁöÑÊó∂ÂÄôÔºåÂÖàËØªÁºìÂ≠òÔºåÁºìÂ≠òÊ≤°ÊúâÁöÑËØùÔºåÂ∞±ËØªÊï∞ÊçÆÂ∫ìÔºåÁÑ∂ÂêéÂèñÂá∫Êï∞ÊçÆÂêéÊîæÂÖ•ÁºìÂ≠òÔºåÂêåÊó∂ËøîÂõûÂìçÂ∫î„ÄÇ</li>
<li>Êõ¥Êñ∞ÁöÑÊó∂ÂÄôÔºå<strong>ÂÖàÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìÔºåÁÑ∂ÂêéÂÜçÂà†Èô§ÁºìÂ≠ò</strong>„ÄÇ</li>
</ul>
<p><strong>‰∏∫‰ªÄ‰πàÊòØÂà†Èô§ÁºìÂ≠òÔºåËÄå‰∏çÊòØÊõ¥Êñ∞ÁºìÂ≠òÔºü</strong></p>
<p>ÂéüÂõ†ÂæàÁÆÄÂçïÔºåÂæàÂ§öÊó∂ÂÄôÔºåÂú®Â§çÊùÇÁÇπÁöÑÁºìÂ≠òÂú∫ÊôØÔºåÁºìÂ≠ò‰∏çÂçïÂçïÊòØÊï∞ÊçÆÂ∫ì‰∏≠Áõ¥Êé•ÂèñÂá∫Êù•ÁöÑÂÄº„ÄÇ</p>
<p>ÊØîÂ¶ÇÂèØËÉΩÊõ¥Êñ∞‰∫ÜÊüê‰∏™Ë°®ÁöÑ‰∏Ä‰∏™Â≠óÊÆµÔºåÁÑ∂ÂêéÂÖ∂ÂØπÂ∫îÁöÑÁºìÂ≠òÔºåÊòØÈúÄË¶ÅÊü•ËØ¢Âè¶Â§ñ‰∏§‰∏™Ë°®ÁöÑÊï∞ÊçÆÂπ∂ËøõË°åËøêÁÆóÔºåÊâçËÉΩËÆ°ÁÆóÂá∫ÁºìÂ≠òÊúÄÊñ∞ÁöÑÂÄºÁöÑ„ÄÇ</p>
<p>Âè¶Â§ñÊõ¥Êñ∞ÁºìÂ≠òÁöÑ‰ª£‰ª∑ÊúâÊó∂ÂÄôÊòØÂæàÈ´òÁöÑ„ÄÇÊòØ‰∏çÊòØËØ¥ÔºåÊØèÊ¨°‰øÆÊîπÊï∞ÊçÆÂ∫ìÁöÑÊó∂ÂÄôÔºåÈÉΩ‰∏ÄÂÆöË¶ÅÂ∞ÜÂÖ∂ÂØπÂ∫îÁöÑÁºìÂ≠òÊõ¥Êñ∞‰∏Ä‰ªΩÔºü‰πüËÆ∏ÊúâÁöÑÂú∫ÊôØÊòØËøôÊ†∑Ôºå‰ΩÜÊòØÂØπ‰∫é<strong>ÊØîËæÉÂ§çÊùÇÁöÑÁºìÂ≠òÊï∞ÊçÆËÆ°ÁÆóÁöÑÂú∫ÊôØ</strong>ÔºåÂ∞±‰∏çÊòØËøôÊ†∑‰∫Ü„ÄÇÂ¶ÇÊûú‰Ω†È¢ëÁπÅ‰øÆÊîπ‰∏Ä‰∏™ÁºìÂ≠òÊ∂âÂèäÁöÑÂ§ö‰∏™Ë°®ÔºåÁºìÂ≠ò‰πüÈ¢ëÁπÅÊõ¥Êñ∞„ÄÇ‰ΩÜÊòØÈóÆÈ¢òÂú®‰∫éÔºå<strong>Ëøô‰∏™ÁºìÂ≠òÂà∞Â∫ï‰ºö‰∏ç‰ºöË¢´È¢ëÁπÅËÆøÈóÆÂà∞Ôºü</strong></p>
<p>‰∏æ‰∏™Ê†óÂ≠êÔºå‰∏Ä‰∏™ÁºìÂ≠òÊ∂âÂèäÁöÑË°®ÁöÑÂ≠óÊÆµÔºåÂú® 1 ÂàÜÈíüÂÜÖÂ∞±‰øÆÊîπ‰∫Ü 20 Ê¨°ÔºåÊàñËÄÖÊòØ 100 Ê¨°ÔºåÈÇ£‰πàÁºìÂ≠òÊõ¥Êñ∞ 20 Ê¨°„ÄÅ100 Ê¨°Ôºõ‰ΩÜÊòØËøô‰∏™ÁºìÂ≠òÂú® 1 ÂàÜÈíüÂÜÖÂè™Ë¢´ËØªÂèñ‰∫Ü 1 Ê¨°ÔºåÊúâ<strong>Â§ßÈáèÁöÑÂÜ∑Êï∞ÊçÆ</strong>„ÄÇÂÆûÈôÖ‰∏äÔºåÂ¶ÇÊûú‰Ω†Âè™ÊòØÂà†Èô§ÁºìÂ≠òÁöÑËØùÔºåÈÇ£‰πàÂú® 1 ÂàÜÈíüÂÜÖÔºåËøô‰∏™ÁºìÂ≠ò‰∏çËøáÂ∞±ÈáçÊñ∞ËÆ°ÁÆó‰∏ÄÊ¨°ËÄåÂ∑≤ÔºåÂºÄÈîÄÂ§ßÂπÖÂ∫¶Èôç‰Ωé„ÄÇ<strong>Áî®Âà∞ÁºìÂ≠òÊâçÂéªÁÆóÁºìÂ≠ò„ÄÇ</strong></p>
<p>ÂÖ∂ÂÆûÂà†Èô§ÁºìÂ≠òÔºåËÄå‰∏çÊòØÊõ¥Êñ∞ÁºìÂ≠òÔºåÂ∞±ÊòØ‰∏Ä‰∏™ lazy ËÆ°ÁÆóÁöÑÊÄùÊÉ≥Ôºå‰∏çË¶ÅÊØèÊ¨°ÈÉΩÈáçÊñ∞ÂÅöÂ§çÊùÇÁöÑËÆ°ÁÆóÔºå‰∏çÁÆ°ÂÆÉ‰ºö‰∏ç‰ºöÁî®Âà∞ÔºåËÄåÊòØËÆ©ÂÆÉÂà∞ÈúÄË¶ÅË¢´‰ΩøÁî®ÁöÑÊó∂ÂÄôÂÜçÈáçÊñ∞ËÆ°ÁÆó„ÄÇÂÉè mybatisÔºåhibernateÔºåÈÉΩÊúâÊáíÂä†ËΩΩÊÄùÊÉ≥„ÄÇÊü•ËØ¢‰∏Ä‰∏™ÈÉ®Èó®ÔºåÈÉ®Èó®Â∏¶‰∫Ü‰∏Ä‰∏™ÂëòÂ∑•ÁöÑ listÔºåÊ≤°ÊúâÂøÖË¶ÅËØ¥ÊØèÊ¨°Êü•ËØ¢ÈÉ®Èó®ÔºåÈÉΩÊääÈáåÈù¢ÁöÑ 1000 ‰∏™ÂëòÂ∑•ÁöÑÊï∞ÊçÆ‰πüÂêåÊó∂Êü•Âá∫Êù•Âïä„ÄÇ80% ÁöÑÊÉÖÂÜµÔºåÊü•Ëøô‰∏™ÈÉ®Èó®ÔºåÂ∞±Âè™ÊòØË¶ÅËÆøÈóÆËøô‰∏™ÈÉ®Èó®ÁöÑ‰ø°ÊÅØÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇÂÖàÊü•ÈÉ®Èó®ÔºåÂêåÊó∂Ë¶ÅËÆøÈóÆÈáåÈù¢ÁöÑÂëòÂ∑•ÔºåÈÇ£‰πàËøô‰∏™Êó∂ÂÄôÂè™ÊúâÂú®‰Ω†Ë¶ÅËÆøÈóÆÈáåÈù¢ÁöÑÂëòÂ∑•ÁöÑÊó∂ÂÄôÔºåÊâç‰ºöÂéªÊï∞ÊçÆÂ∫ìÈáåÈù¢Êü•ËØ¢ 1000 ‰∏™ÂëòÂ∑•„ÄÇ</p>
<h2 id="143-ÊúÄÂàùÁ∫ßÁöÑÁºìÂ≠ò‰∏ç‰∏ÄËá¥ÈóÆÈ¢òÂèäËß£ÂÜ≥ÊñπÊ°à"><a class="markdownIt-Anchor" href="#143-ÊúÄÂàùÁ∫ßÁöÑÁºìÂ≠ò‰∏ç‰∏ÄËá¥ÈóÆÈ¢òÂèäËß£ÂÜ≥ÊñπÊ°à"></a> 14.3: ÊúÄÂàùÁ∫ßÁöÑÁºìÂ≠ò‰∏ç‰∏ÄËá¥ÈóÆÈ¢òÂèäËß£ÂÜ≥ÊñπÊ°à</h2>
<p>ÈóÆÈ¢òÔºöÂÖàÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìÔºåÂÜçÂà†Èô§ÁºìÂ≠ò„ÄÇÂ¶ÇÊûúÂà†Èô§ÁºìÂ≠òÂ§±Ë¥•‰∫ÜÔºåÈÇ£‰πà‰ºöÂØºËá¥Êï∞ÊçÆÂ∫ì‰∏≠ÊòØÊñ∞Êï∞ÊçÆÔºåÁºìÂ≠ò‰∏≠ÊòØÊóßÊï∞ÊçÆÔºåÊï∞ÊçÆÂ∞±Âá∫Áé∞‰∫Ü‰∏ç‰∏ÄËá¥„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301684.png" srcset="/img/loading.gif" lazyload alt="redis-junior-inconsistent"></p>
<p>Ëß£ÂÜ≥ÊÄùË∑Ø 1ÔºöÂÖàÂà†Èô§ÁºìÂ≠òÔºåÂÜçÊõ¥Êñ∞Êï∞ÊçÆÂ∫ì„ÄÇÂ¶ÇÊûúÊï∞ÊçÆÂ∫ìÊõ¥Êñ∞Â§±Ë¥•‰∫ÜÔºåÈÇ£‰πàÊï∞ÊçÆÂ∫ì‰∏≠ÊòØÊóßÊï∞ÊçÆÔºåÁºìÂ≠ò‰∏≠ÊòØÁ©∫ÁöÑÔºåÈÇ£‰πàÊï∞ÊçÆ‰∏ç‰ºö‰∏ç‰∏ÄËá¥„ÄÇÂõ†‰∏∫ËØªÁöÑÊó∂ÂÄôÁºìÂ≠òÊ≤°ÊúâÔºåÊâÄ‰ª•ÂéªËØª‰∫ÜÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊóßÊï∞ÊçÆÔºåÁÑ∂ÂêéÊõ¥Êñ∞Âà∞ÁºìÂ≠ò‰∏≠„ÄÇ</p>
<p>Ëß£ÂÜ≥ÊÄùË∑Ø 2ÔºöÂª∂Êó∂ÂèåÂà†„ÄÇ‰æùÊóßÊòØÂÖàÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìÔºåÂÜçÂà†Èô§ÁºìÂ≠òÔºåÂîØ‰∏Ä‰∏çÂêåÁöÑÊòØÔºåÊàë‰ª¨ÊääËøô‰∏™Âà†Èô§ÁöÑÂä®‰ΩúÔºåÂú®‰∏ç‰πÖ‰πãÂêéÂÜçÊâßË°å‰∏ÄÊ¨°ÔºåÊØîÂ¶Ç 5s ‰πãÂêé„ÄÇ</p>
<figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public void set(key, value) {<br>    put<span class="hljs-constructor">ToDb(<span class="hljs-params">key</span>, <span class="hljs-params">value</span>)</span>;<br>    delete<span class="hljs-constructor">FromRedis(<span class="hljs-params">key</span>)</span>;<br><br>    <span class="hljs-comment">// ... a few seconds later</span><br>    delete<span class="hljs-constructor">FromRedis(<span class="hljs-params">key</span>)</span>;<br>}Copy <span class="hljs-keyword">to</span> clipboardErrorCopied<br></code></pre></td></tr></tbody></table></figure>
<p>Âà†Èô§ÁöÑÂä®‰ΩúÔºåÂèØ‰ª•ÊúâÂ§öÁßçÈÄâÊã©ÔºåÊØîÂ¶ÇÔºö1. ‰ΩøÁî® <code>DelayQueue</code>Ôºå‰ºöÈöèÁùÄ JVM ËøõÁ®ãÁöÑÊ≠ª‰∫°Ôºå‰∏¢Â§±Êõ¥Êñ∞ÁöÑÈ£éÈô©Ôºõ2. ÊîæÂú® <code>MQ</code>Ôºå‰ΩÜÁºñÁ†ÅÂ§çÊùÇÂ∫¶‰∏∫Â¢ûÂä†„ÄÇÊÄª‰πãÔºåÊàë‰ª¨ÈúÄË¶ÅÁªºÂêàÂêÑÁßçÂõ†Á¥†ÂéªÂÅöËÆæËÆ°ÔºåÈÄâÊã©‰∏Ä‰∏™ÊúÄÂêàÁêÜÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇ</p>
<h2 id="144-ÊØîËæÉÂ§çÊùÇÁöÑÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÈóÆÈ¢òÂàÜÊûê"><a class="markdownIt-Anchor" href="#144-ÊØîËæÉÂ§çÊùÇÁöÑÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÈóÆÈ¢òÂàÜÊûê"></a> 14.4: ÊØîËæÉÂ§çÊùÇÁöÑÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÈóÆÈ¢òÂàÜÊûê</h2>
<p>Êï∞ÊçÆÂèëÁîü‰∫ÜÂèòÊõ¥ÔºåÂÖàÂà†Èô§‰∫ÜÁºìÂ≠òÔºåÁÑ∂ÂêéË¶ÅÂéª‰øÆÊîπÊï∞ÊçÆÂ∫ìÔºåÊ≠§Êó∂ËøòÊ≤°‰øÆÊîπ„ÄÇ‰∏Ä‰∏™ËØ∑Ê±ÇËøáÊù•ÔºåÂéªËØªÁºìÂ≠òÔºåÂèëÁé∞ÁºìÂ≠òÁ©∫‰∫ÜÔºåÂéªÊü•ËØ¢Êï∞ÊçÆÂ∫ìÔºå<strong>Êü•Âà∞‰∫Ü‰øÆÊîπÂâçÁöÑÊóßÊï∞ÊçÆ</strong>ÔºåÊîæÂà∞‰∫ÜÁºìÂ≠ò‰∏≠„ÄÇÈöèÂêéÊï∞ÊçÆÂèòÊõ¥ÁöÑÁ®ãÂ∫èÂÆåÊàê‰∫ÜÊï∞ÊçÆÂ∫ìÁöÑ‰øÆÊîπ„ÄÇÂÆå‰∫ÜÔºåÊï∞ÊçÆÂ∫ìÂíåÁºìÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆ‰∏ç‰∏ÄÊ†∑‰∫Ü‚Ä¶</p>
<p><strong>‰∏∫‰ªÄ‰πà‰∏ä‰∫øÊµÅÈáèÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÁºìÂ≠ò‰ºöÂá∫Áé∞Ëøô‰∏™ÈóÆÈ¢òÔºü</strong></p>
<p>Âè™ÊúâÂú®ÂØπ‰∏Ä‰∏™Êï∞ÊçÆÂú®Âπ∂ÂèëÁöÑËøõË°åËØªÂÜôÁöÑÊó∂ÂÄôÔºåÊâçÂèØËÉΩ‰ºöÂá∫Áé∞ËøôÁßçÈóÆÈ¢ò„ÄÇÂÖ∂ÂÆûÂ¶ÇÊûúËØ¥‰Ω†ÁöÑÂπ∂ÂèëÈáèÂæà‰ΩéÁöÑËØùÔºåÁâπÂà´ÊòØËØªÂπ∂ÂèëÂæà‰ΩéÔºåÊØèÂ§©ËÆøÈóÆÈáèÂ∞± 1 ‰∏áÊ¨°ÔºåÈÇ£‰πàÂæàÂ∞ëÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ºöÂá∫Áé∞ÂàöÊâçÊèèËø∞ÁöÑÈÇ£Áßç‰∏ç‰∏ÄËá¥ÁöÑÂú∫ÊôØ„ÄÇ‰ΩÜÊòØÈóÆÈ¢òÊòØÔºåÂ¶ÇÊûúÊØèÂ§©ÁöÑÊòØ‰∏ä‰∫øÁöÑÊµÅÈáèÔºåÊØèÁßíÂπ∂ÂèëËØªÊòØÂá†‰∏áÔºåÊØèÁßíÂè™Ë¶ÅÊúâÊï∞ÊçÆÊõ¥Êñ∞ÁöÑËØ∑Ê±ÇÔºåÂ∞±<strong>ÂèØËÉΩ‰ºöÂá∫Áé∞‰∏äËø∞ÁöÑÊï∞ÊçÆÂ∫ì+ÁºìÂ≠ò‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ</strong>„ÄÇ</p>
<p><strong>Ëß£ÂÜ≥ÊñπÊ°àÂ¶Ç‰∏ãÔºö</strong></p>
<p>Êõ¥Êñ∞Êï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÊ†πÊçÆ<strong>Êï∞ÊçÆÁöÑÂîØ‰∏ÄÊ†áËØÜ</strong>ÔºåÂ∞ÜÊìç‰ΩúË∑ØÁî±‰πãÂêéÔºåÂèëÈÄÅÂà∞‰∏Ä‰∏™ jvm ÂÜÖÈÉ®ÈòüÂàó‰∏≠„ÄÇËØªÂèñÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÂèëÁé∞Êï∞ÊçÆ‰∏çÂú®ÁºìÂ≠ò‰∏≠ÔºåÈÇ£‰πàÂ∞ÜÈáçÊñ∞ÊâßË°å‚ÄúËØªÂèñÊï∞ÊçÆ+Êõ¥Êñ∞ÁºìÂ≠ò‚ÄùÁöÑÊìç‰ΩúÔºåÊ†πÊçÆÂîØ‰∏ÄÊ†áËØÜË∑ØÁî±‰πãÂêéÔºå‰πüÂèëÈÄÅÂà∞Âêå‰∏Ä‰∏™ jvm ÂÜÖÈÉ®ÈòüÂàó‰∏≠„ÄÇ</p>
<p>‰∏Ä‰∏™ÈòüÂàóÂØπÂ∫î‰∏Ä‰∏™Â∑•‰ΩúÁ∫øÁ®ãÔºåÊØè‰∏™Â∑•‰ΩúÁ∫øÁ®ã<strong>‰∏≤Ë°å</strong>ÊãøÂà∞ÂØπÂ∫îÁöÑÊìç‰ΩúÔºåÁÑ∂Âêé‰∏ÄÊù°‰∏ÄÊù°ÁöÑÊâßË°å„ÄÇËøôÊ†∑ÁöÑËØùÔºå‰∏Ä‰∏™Êï∞ÊçÆÂèòÊõ¥ÁöÑÊìç‰ΩúÔºåÂÖàÂà†Èô§ÁºìÂ≠òÔºåÁÑ∂ÂêéÂÜçÂéªÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìÔºå‰ΩÜÊòØËøòÊ≤°ÂÆåÊàêÊõ¥Êñ∞„ÄÇÊ≠§Êó∂Â¶ÇÊûú‰∏Ä‰∏™ËØªËØ∑Ê±ÇËøáÊù•ÔºåÊ≤°ÊúâËØªÂà∞ÁºìÂ≠òÔºåÈÇ£‰πàÂèØ‰ª•ÂÖàÂ∞ÜÁºìÂ≠òÊõ¥Êñ∞ÁöÑËØ∑Ê±ÇÂèëÈÄÅÂà∞ÈòüÂàó‰∏≠ÔºåÊ≠§Êó∂‰ºöÂú®ÈòüÂàó‰∏≠ÁßØÂéãÔºåÁÑ∂ÂêéÂêåÊ≠•Á≠âÂæÖÁºìÂ≠òÊõ¥Êñ∞ÂÆåÊàê„ÄÇ</p>
<p>ËøôÈáåÊúâ‰∏Ä‰∏™<strong>‰ºòÂåñÁÇπ</strong>Ôºå‰∏Ä‰∏™ÈòüÂàó‰∏≠ÔºåÂÖ∂ÂÆû<strong>Â§ö‰∏™Êõ¥Êñ∞ÁºìÂ≠òËØ∑Ê±Ç‰∏≤Âú®‰∏ÄËµ∑ÊòØÊ≤°ÊÑè‰πâÁöÑ</strong>ÔºåÂõ†Ê≠§ÂèØ‰ª•ÂÅöËøáÊª§ÔºåÂ¶ÇÊûúÂèëÁé∞ÈòüÂàó‰∏≠Â∑≤ÁªèÊúâ‰∏Ä‰∏™Êõ¥Êñ∞ÁºìÂ≠òÁöÑËØ∑Ê±Ç‰∫ÜÔºåÈÇ£‰πàÂ∞±‰∏çÁî®ÂÜçÊîæ‰∏™Êõ¥Êñ∞ËØ∑Ê±ÇÊìç‰ΩúËøõÂéª‰∫ÜÔºåÁõ¥Êé•Á≠âÂæÖÂâçÈù¢ÁöÑÊõ¥Êñ∞Êìç‰ΩúËØ∑Ê±ÇÂÆåÊàêÂç≥ÂèØ„ÄÇ</p>
<p>ÂæÖÈÇ£‰∏™ÈòüÂàóÂØπÂ∫îÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÂÆåÊàê‰∫Ü‰∏ä‰∏Ä‰∏™Êìç‰ΩúÁöÑÊï∞ÊçÆÂ∫ìÁöÑ‰øÆÊîπ‰πãÂêéÔºåÊâç‰ºöÂéªÊâßË°å‰∏ã‰∏Ä‰∏™Êìç‰ΩúÔºå‰πüÂ∞±ÊòØÁºìÂ≠òÊõ¥Êñ∞ÁöÑÊìç‰ΩúÔºåÊ≠§Êó∂‰ºö‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ËØªÂèñÊúÄÊñ∞ÁöÑÂÄºÔºåÁÑ∂ÂêéÂÜôÂÖ•ÁºìÂ≠ò‰∏≠„ÄÇ</p>
<p>Â¶ÇÊûúËØ∑Ê±ÇËøòÂú®Á≠âÂæÖÊó∂Èó¥ËåÉÂõ¥ÂÜÖÔºå‰∏çÊñ≠ËΩÆËØ¢ÂèëÁé∞ÂèØ‰ª•ÂèñÂà∞ÂÄº‰∫ÜÔºåÈÇ£‰πàÂ∞±Áõ¥Êé•ËøîÂõûÔºõÂ¶ÇÊûúËØ∑Ê±ÇÁ≠âÂæÖÁöÑÊó∂Èó¥Ë∂ÖËøá‰∏ÄÂÆöÊó∂ÈïøÔºåÈÇ£‰πàËøô‰∏ÄÊ¨°Áõ¥Êé•‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ËØªÂèñÂΩìÂâçÁöÑÊóßÂÄº„ÄÇ</p>
<p>È´òÂπ∂ÂèëÁöÑÂú∫ÊôØ‰∏ãÔºåËØ•Ëß£ÂÜ≥ÊñπÊ°àË¶ÅÊ≥®ÊÑèÁöÑÈóÆÈ¢òÔºö</p>
<ul>
<li>ËØªËØ∑Ê±ÇÈïøÊó∂ÈòªÂ°û</li>
</ul>
<p>Áî±‰∫éËØªËØ∑Ê±ÇËøõË°å‰∫ÜÈùûÂ∏∏ËΩªÂ∫¶ÁöÑÂºÇÊ≠•ÂåñÔºåÊâÄ‰ª•‰∏ÄÂÆöË¶ÅÊ≥®ÊÑèËØªË∂ÖÊó∂ÁöÑÈóÆÈ¢òÔºåÊØè‰∏™ËØªËØ∑Ê±ÇÂøÖÈ°ªÂú®Ë∂ÖÊó∂Êó∂Èó¥ËåÉÂõ¥ÂÜÖËøîÂõû„ÄÇ</p>
<p>ËØ•Ëß£ÂÜ≥ÊñπÊ°àÔºåÊúÄÂ§ßÁöÑÈ£éÈô©ÁÇπÂú®‰∫éËØ¥Ôºå<strong>ÂèØËÉΩÊï∞ÊçÆÊõ¥Êñ∞ÂæàÈ¢ëÁπÅ</strong>ÔºåÂØºËá¥ÈòüÂàó‰∏≠ÁßØÂéã‰∫ÜÂ§ßÈáèÊõ¥Êñ∞Êìç‰ΩúÂú®ÈáåÈù¢ÔºåÁÑ∂Âêé<strong>ËØªËØ∑Ê±Ç‰ºöÂèëÁîüÂ§ßÈáèÁöÑË∂ÖÊó∂</strong>ÔºåÊúÄÂêéÂØºËá¥Â§ßÈáèÁöÑËØ∑Ê±ÇÁõ¥Êé•Ëµ∞Êï∞ÊçÆÂ∫ì„ÄÇÂä°ÂøÖÈÄöËøá‰∏Ä‰∫õÊ®°ÊãüÁúüÂÆûÁöÑÊµãËØïÔºåÁúãÁúãÊõ¥Êñ∞Êï∞ÊçÆÁöÑÈ¢ëÁéáÊòØÊÄéÊ†∑ÁöÑ„ÄÇ</p>
<p>Âè¶Â§ñ‰∏ÄÁÇπÔºåÂõ†‰∏∫‰∏Ä‰∏™ÈòüÂàó‰∏≠ÔºåÂèØËÉΩ‰ºöÁßØÂéãÈíàÂØπÂ§ö‰∏™Êï∞ÊçÆÈ°πÁöÑÊõ¥Êñ∞Êìç‰ΩúÔºåÂõ†Ê≠§ÈúÄË¶ÅÊ†πÊçÆËá™Â∑±ÁöÑ‰∏öÂä°ÊÉÖÂÜµËøõË°åÊµãËØïÔºåÂèØËÉΩÈúÄË¶Å<strong>ÈÉ®ÁΩ≤Â§ö‰∏™ÊúçÂä°</strong>ÔºåÊØè‰∏™ÊúçÂä°ÂàÜÊëä‰∏Ä‰∫õÊï∞ÊçÆÁöÑÊõ¥Êñ∞Êìç‰Ωú„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™ÂÜÖÂ≠òÈòüÂàóÈáåÂ±ÖÁÑ∂‰ºöÊå§Âéã 100 ‰∏™ÂïÜÂìÅÁöÑÂ∫ìÂ≠ò‰øÆÊîπÊìç‰ΩúÔºåÊØè‰∏™Â∫ìÂ≠ò‰øÆÊîπÊìç‰ΩúË¶ÅËÄóË¥π 10ms ÂéªÂÆåÊàêÔºåÈÇ£‰πàÊúÄÂêé‰∏Ä‰∏™ÂïÜÂìÅÁöÑËØªËØ∑Ê±ÇÔºåÂèØËÉΩÁ≠âÂæÖ 10 * 100 = 1000ms = 1s ÂêéÔºåÊâçËÉΩÂæóÂà∞Êï∞ÊçÆÔºåËøô‰∏™Êó∂ÂÄôÂ∞±ÂØºËá¥<strong>ËØªËØ∑Ê±ÇÁöÑÈïøÊó∂ÈòªÂ°û</strong>„ÄÇ</p>
<p>‰∏ÄÂÆöË¶ÅÂÅöÊ†πÊçÆÂÆûÈôÖ‰∏öÂä°Á≥ªÁªüÁöÑËøêË°åÊÉÖÂÜµÔºåÂéªËøõË°å‰∏Ä‰∫õÂéãÂäõÊµãËØïÔºåÂíåÊ®°ÊãüÁ∫ø‰∏äÁéØÂ¢ÉÔºåÂéªÁúãÁúãÊúÄÁπÅÂøôÁöÑÊó∂ÂÄôÔºåÂÜÖÂ≠òÈòüÂàóÂèØËÉΩ‰ºöÊå§ÂéãÂ§öÂ∞ëÊõ¥Êñ∞Êìç‰ΩúÔºåÂèØËÉΩ‰ºöÂØºËá¥ÊúÄÂêé‰∏Ä‰∏™Êõ¥Êñ∞Êìç‰ΩúÂØπÂ∫îÁöÑËØªËØ∑Ê±ÇÔºå‰ºö hang Â§öÂ∞ëÊó∂Èó¥ÔºåÂ¶ÇÊûúËØªËØ∑Ê±ÇÂú® 200ms ËøîÂõûÔºåÂ¶ÇÊûú‰Ω†ËÆ°ÁÆóËøáÂêéÔºåÂì™ÊÄïÊòØÊúÄÁπÅÂøôÁöÑÊó∂ÂÄôÔºåÁßØÂéã 10 ‰∏™Êõ¥Êñ∞Êìç‰ΩúÔºåÊúÄÂ§öÁ≠âÂæÖ 200msÔºåÈÇ£ËøòÂèØ‰ª•ÁöÑ„ÄÇ</p>
<p><strong>Â¶ÇÊûú‰∏Ä‰∏™ÂÜÖÂ≠òÈòüÂàó‰∏≠ÂèØËÉΩÁßØÂéãÁöÑÊõ¥Êñ∞Êìç‰ΩúÁâπÂà´Â§ö</strong>ÔºåÈÇ£‰πà‰Ω†Â∞±Ë¶Å<strong>Âä†Êú∫Âô®</strong>ÔºåËÆ©ÊØè‰∏™Êú∫Âô®‰∏äÈÉ®ÁΩ≤ÁöÑÊúçÂä°ÂÆû‰æãÂ§ÑÁêÜÊõ¥Â∞ëÁöÑÊï∞ÊçÆÔºåÈÇ£‰πàÊØè‰∏™ÂÜÖÂ≠òÈòüÂàó‰∏≠ÁßØÂéãÁöÑÊõ¥Êñ∞Êìç‰ΩúÂ∞±‰ºöË∂äÂ∞ë„ÄÇ</p>
<p>ÂÖ∂ÂÆûÊ†πÊçÆ‰πãÂâçÁöÑÈ°πÁõÆÁªèÈ™åÔºå‰∏ÄËà¨Êù•ËØ¥ÔºåÊï∞ÊçÆÁöÑÂÜôÈ¢ëÁéáÊòØÂæà‰ΩéÁöÑÔºåÂõ†Ê≠§ÂÆûÈôÖ‰∏äÊ≠£Â∏∏Êù•ËØ¥ÔºåÂú®ÈòüÂàó‰∏≠ÁßØÂéãÁöÑÊõ¥Êñ∞Êìç‰ΩúÂ∫îËØ•ÊòØÂæàÂ∞ëÁöÑ„ÄÇÂÉèËøôÁßçÈíàÂØπËØªÈ´òÂπ∂Âèë„ÄÅËØªÁºìÂ≠òÊû∂ÊûÑÁöÑÈ°πÁõÆÔºå‰∏ÄËà¨Êù•ËØ¥ÂÜôËØ∑Ê±ÇÊòØÈùûÂ∏∏Â∞ëÁöÑÔºåÊØèÁßíÁöÑ QPS ËÉΩÂà∞Âá†ÁôæÂ∞±‰∏çÈîô‰∫Ü„ÄÇ</p>
<p>Êàë‰ª¨Êù•<strong>ÂÆûÈôÖÁ≤óÁï•ÊµãÁÆó‰∏Ä‰∏ã</strong>„ÄÇ</p>
<p>Â¶ÇÊûú‰∏ÄÁßíÊúâ 500 ÁöÑÂÜôÊìç‰ΩúÔºåÂ¶ÇÊûúÂàÜÊàê 5 ‰∏™Êó∂Èó¥ÁâáÔºåÊØè 200ms Â∞± 100 ‰∏™ÂÜôÊìç‰ΩúÔºåÊîæÂà∞ 20 ‰∏™ÂÜÖÂ≠òÈòüÂàó‰∏≠ÔºåÊØè‰∏™ÂÜÖÂ≠òÈòüÂàóÔºåÂèØËÉΩÂ∞±ÁßØÂéã 5 ‰∏™ÂÜôÊìç‰Ωú„ÄÇÊØè‰∏™ÂÜôÊìç‰ΩúÊÄßËÉΩÊµãËØïÂêéÔºå‰∏ÄËà¨ÊòØÂú® 20ms Â∑¶Âè≥Â∞±ÂÆåÊàêÔºåÈÇ£‰πàÈíàÂØπÊØè‰∏™ÂÜÖÂ≠òÈòüÂàóÁöÑÊï∞ÊçÆÁöÑËØªËØ∑Ê±ÇÔºå‰πüÂ∞±ÊúÄÂ§ö hang ‰∏Ä‰ºöÂÑøÔºå200ms ‰ª•ÂÜÖËÇØÂÆöËÉΩËøîÂõû‰∫Ü„ÄÇ</p>
<p>ÁªèËøáÂàöÊâçÁÆÄÂçïÁöÑÊµãÁÆóÔºåÊàë‰ª¨Áü•ÈÅìÔºåÂçïÊú∫ÊîØÊíëÁöÑÂÜô QPS Âú®Âá†ÁôæÊòØÊ≤°ÈóÆÈ¢òÁöÑÔºåÂ¶ÇÊûúÂÜô QPS Êâ©Â§ß‰∫Ü 10 ÂÄçÔºåÈÇ£‰πàÂ∞±Êâ©ÂÆπÊú∫Âô®ÔºåÊâ©ÂÆπ 10 ÂÄçÁöÑÊú∫Âô®ÔºåÊØè‰∏™Êú∫Âô® 20 ‰∏™ÈòüÂàó„ÄÇ</p>
<ul>
<li>ËØªËØ∑Ê±ÇÂπ∂ÂèëÈáèËøáÈ´ò</li>
</ul>
<p>ËøôÈáåËøòÂøÖÈ°ªÂÅöÂ•ΩÂéãÂäõÊµãËØïÔºåÁ°Æ‰øùÊÅ∞Â∑ßÁ¢∞‰∏ä‰∏äËø∞ÊÉÖÂÜµÁöÑÊó∂ÂÄôÔºåËøòÊúâ‰∏Ä‰∏™È£éÈô©ÔºåÂ∞±ÊòØÁ™ÅÁÑ∂Èó¥Â§ßÈáèËØªËØ∑Ê±Ç‰ºöÂú®Âá†ÂçÅÊØ´ÁßíÁöÑÂª∂Êó∂ hang Âú®ÊúçÂä°‰∏äÔºåÁúãÊúçÂä°ËÉΩ‰∏çËÉΩÊâõÁöÑ‰ΩèÔºåÈúÄË¶ÅÂ§öÂ∞ëÊú∫Âô®ÊâçËÉΩÊâõ‰ΩèÊúÄÂ§ßÁöÑÊûÅÈôêÊÉÖÂÜµÁöÑÂ≥∞ÂÄº„ÄÇ</p>
<p>‰ΩÜÊòØÂõ†‰∏∫Âπ∂‰∏çÊòØÊâÄÊúâÁöÑÊï∞ÊçÆÈÉΩÂú®Âêå‰∏ÄÊó∂Èó¥Êõ¥Êñ∞ÔºåÁºìÂ≠ò‰πü‰∏ç‰ºöÂêå‰∏ÄÊó∂Èó¥Â§±ÊïàÔºåÊâÄ‰ª•ÊØèÊ¨°ÂèØËÉΩ‰πüÂ∞±ÊòØÂ∞ëÊï∞Êï∞ÊçÆÁöÑÁºìÂ≠òÂ§±Êïà‰∫ÜÔºåÁÑ∂ÂêéÈÇ£‰∫õÊï∞ÊçÆÂØπÂ∫îÁöÑËØªËØ∑Ê±ÇËøáÊù•ÔºåÂπ∂ÂèëÈáèÂ∫îËØ•‰πü‰∏ç‰ºöÁâπÂà´Â§ß„ÄÇ</p>
<ul>
<li>Â§öÊúçÂä°ÂÆû‰æãÈÉ®ÁΩ≤ÁöÑËØ∑Ê±ÇË∑ØÁî±</li>
</ul>
<p>ÂèØËÉΩËøô‰∏™ÊúçÂä°ÈÉ®ÁΩ≤‰∫ÜÂ§ö‰∏™ÂÆû‰æãÔºåÈÇ£‰πàÂøÖÈ°ª<strong>‰øùËØÅ</strong>ËØ¥ÔºåÊâßË°åÊï∞ÊçÆÊõ¥Êñ∞Êìç‰ΩúÔºå‰ª•ÂèäÊâßË°åÁºìÂ≠òÊõ¥Êñ∞Êìç‰ΩúÁöÑËØ∑Ê±ÇÔºåÈÉΩÈÄöËøá Nginx ÊúçÂä°Âô®<strong>Ë∑ØÁî±Âà∞Áõ∏ÂêåÁöÑÊúçÂä°ÂÆû‰æã‰∏ä</strong>„ÄÇ</p>
<p>ÊØîÂ¶ÇËØ¥ÔºåÂØπÂêå‰∏Ä‰∏™ÂïÜÂìÅÁöÑËØªÂÜôËØ∑Ê±ÇÔºåÂÖ®ÈÉ®Ë∑ØÁî±Âà∞Âêå‰∏ÄÂè∞Êú∫Âô®‰∏ä„ÄÇÂèØ‰ª•Ëá™Â∑±ÂéªÂÅöÊúçÂä°Èó¥ÁöÑÊåâÁÖßÊüê‰∏™ËØ∑Ê±ÇÂèÇÊï∞ÁöÑ hash Ë∑ØÁî±Ôºå‰πüÂèØ‰ª•Áî® Nginx ÁöÑ hash Ë∑ØÁî±ÂäüËÉΩÁ≠âÁ≠â„ÄÇ</p>
<ul>
<li>ÁÉ≠ÁÇπÂïÜÂìÅÁöÑË∑ØÁî±ÈóÆÈ¢òÔºåÂØºËá¥ËØ∑Ê±ÇÁöÑÂÄæÊñú</li>
</ul>
<p>‰∏á‰∏ÄÊüê‰∏™ÂïÜÂìÅÁöÑËØªÂÜôËØ∑Ê±ÇÁâπÂà´È´òÔºåÂÖ®ÈÉ®ÊâìÂà∞Áõ∏ÂêåÁöÑÊú∫Âô®ÁöÑÁõ∏ÂêåÁöÑÈòüÂàóÈáåÈù¢Âéª‰∫ÜÔºåÂèØËÉΩ‰ºöÈÄ†ÊàêÊüêÂè∞Êú∫Âô®ÁöÑÂéãÂäõËøáÂ§ß„ÄÇÂ∞±ÊòØËØ¥ÔºåÂõ†‰∏∫Âè™ÊúâÂú®ÂïÜÂìÅÊï∞ÊçÆÊõ¥Êñ∞ÁöÑÊó∂ÂÄôÊâç‰ºöÊ∏ÖÁ©∫ÁºìÂ≠òÔºåÁÑ∂ÂêéÊâç‰ºöÂØºËá¥ËØªÂÜôÂπ∂ÂèëÔºåÊâÄ‰ª•ÂÖ∂ÂÆûË¶ÅÊ†πÊçÆ‰∏öÂä°Á≥ªÁªüÂéªÁúãÔºåÂ¶ÇÊûúÊõ¥Êñ∞È¢ëÁéá‰∏çÊòØÂ§™È´òÁöÑËØùÔºåËøô‰∏™ÈóÆÈ¢òÁöÑÂΩ±ÂìçÂπ∂‰∏çÊòØÁâπÂà´Â§ßÔºå‰ΩÜÊòØÁöÑÁ°ÆÂèØËÉΩÊüê‰∫õÊú∫Âô®ÁöÑË¥üËΩΩ‰ºöÈ´ò‰∏Ä‰∫õ„ÄÇ</p>
<h1 id="15-29-redis-ÁöÑÂπ∂ÂèëÁ´û‰∫âÈóÆÈ¢òÊòØ‰ªÄ‰πàÂ¶Ç‰ΩïËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò‰∫ÜËß£-redis-‰∫ãÂä°ÁöÑ-cas-ÊñπÊ°àÂêó"><a class="markdownIt-Anchor" href="#15-29-redis-ÁöÑÂπ∂ÂèëÁ´û‰∫âÈóÆÈ¢òÊòØ‰ªÄ‰πàÂ¶Ç‰ΩïËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò‰∫ÜËß£-redis-‰∫ãÂä°ÁöÑ-cas-ÊñπÊ°àÂêó"></a> 15: 29„ÄÅRedis ÁöÑÂπ∂ÂèëÁ´û‰∫âÈóÆÈ¢òÊòØ‰ªÄ‰πàÔºüÂ¶Ç‰ΩïËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºü‰∫ÜËß£ Redis ‰∫ãÂä°ÁöÑ CAS ÊñπÊ°àÂêóÔºü</h1>
<p>Ëøô‰∏™‰πüÊòØÁ∫ø‰∏äÈùûÂ∏∏Â∏∏ËßÅÁöÑ‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂ∞±ÊòØ<strong>Â§öÂÆ¢Êà∑Á´ØÂêåÊó∂Âπ∂ÂèëÂÜô</strong>‰∏Ä‰∏™ keyÔºåÂèØËÉΩÊú¨Êù•Â∫îËØ•ÂÖàÂà∞ÁöÑÊï∞ÊçÆÂêéÂà∞‰∫ÜÔºåÂØºËá¥Êï∞ÊçÆÁâàÊú¨Èîô‰∫ÜÔºõÊàñËÄÖÊòØÂ§öÂÆ¢Êà∑Á´ØÂêåÊó∂Ëé∑Âèñ‰∏Ä‰∏™ keyÔºå‰øÆÊîπÂÄº‰πãÂêéÂÜçÂÜôÂõûÂéªÔºåÂè™Ë¶ÅÈ°∫Â∫èÈîô‰∫ÜÔºåÊï∞ÊçÆÂ∞±Èîô‰∫Ü„ÄÇ</p>
<p>ËÄå‰∏î Redis Ëá™Â∑±Â∞±ÊúâÂ§©ÁÑ∂Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÁöÑ CAS Á±ªÁöÑ‰πêËßÇÈîÅÊñπÊ°à„ÄÇ</p>
<p>Êüê‰∏™Êó∂ÂàªÔºåÂ§ö‰∏™Á≥ªÁªüÂÆû‰æãÈÉΩÂéªÊõ¥Êñ∞Êüê‰∏™ key„ÄÇÂèØ‰ª•Âü∫‰∫é zookeeper ÂÆûÁé∞ÂàÜÂ∏ÉÂºèÈîÅ„ÄÇÊØè‰∏™Á≥ªÁªüÈÄöËøá zookeeper Ëé∑ÂèñÂàÜÂ∏ÉÂºèÈîÅÔºåÁ°Æ‰øùÂêå‰∏ÄÊó∂Èó¥ÔºåÂè™ËÉΩÊúâ‰∏Ä‰∏™Á≥ªÁªüÂÆû‰æãÂú®Êìç‰ΩúÊüê‰∏™ keyÔºåÂà´‰∫∫ÈÉΩ‰∏çÂÖÅËÆ∏ËØªÂíåÂÜô„ÄÇ</p>
<p><img src="https://axiu-image-bed.oss-cn-shanghai.aliyuncs.com/img/202208092301751.png" srcset="/img/loading.gif" lazyload alt="zookeeper-distributed-lock"></p>
<p>‰Ω†Ë¶ÅÂÜôÂÖ•ÁºìÂ≠òÁöÑÊï∞ÊçÆÔºåÈÉΩÊòØ‰ªé mysql ÈáåÊü•Âá∫Êù•ÁöÑÔºåÈÉΩÂæóÂÜôÂÖ• mysql ‰∏≠ÔºåÂÜôÂÖ• mysql ‰∏≠ÁöÑÊó∂ÂÄôÂøÖÈ°ª‰øùÂ≠ò‰∏Ä‰∏™Êó∂Èó¥Êà≥Ôºå‰ªé mysql Êü•Âá∫Êù•ÁöÑÊó∂ÂÄôÔºåÊó∂Èó¥Êà≥‰πüÊü•Âá∫Êù•„ÄÇ</p>
<p>ÊØèÊ¨°Ë¶Å<strong>ÂÜô‰πãÂâçÔºåÂÖàÂà§Êñ≠</strong>‰∏Ä‰∏ãÂΩìÂâçËøô‰∏™ value ÁöÑÊó∂Èó¥Êà≥ÊòØÂê¶ÊØîÁºìÂ≠òÈáåÁöÑ value ÁöÑÊó∂Èó¥Êà≥Ë¶ÅÊñ∞„ÄÇÂ¶ÇÊûúÊòØÁöÑËØùÔºåÈÇ£‰πàÂèØ‰ª•ÂÜôÔºåÂê¶ÂàôÔºåÂ∞±‰∏çËÉΩÁî®ÊóßÁöÑÊï∞ÊçÆË¶ÜÁõñÊñ∞ÁöÑÊï∞ÊçÆ„ÄÇ</p>
<h1 id="16-30-Áîü‰∫ßÁéØÂ¢É‰∏≠ÁöÑ-redis-ÊòØÊÄé‰πàÈÉ®ÁΩ≤ÁöÑ"><a class="markdownIt-Anchor" href="#16-30-Áîü‰∫ßÁéØÂ¢É‰∏≠ÁöÑ-redis-ÊòØÊÄé‰πàÈÉ®ÁΩ≤ÁöÑ"></a> 16: 30„ÄÅÁîü‰∫ßÁéØÂ¢É‰∏≠ÁöÑ Redis ÊòØÊÄé‰πàÈÉ®ÁΩ≤ÁöÑÔºü</h1>
<p>ÁúãÁúã‰Ω†‰∫ÜËß£‰∏ç‰∫ÜËß£‰Ω†‰ª¨ÂÖ¨Âè∏ÁöÑ Redis Áîü‰∫ßÈõÜÁæ§ÁöÑÈÉ®ÁΩ≤Êû∂ÊûÑÔºåÂ¶ÇÊûú‰Ω†‰∏ç‰∫ÜËß£ÔºåÈÇ£‰πàÁ°ÆÂÆû‰Ω†Â∞±ÂæàÂ§±ËÅå‰∫ÜÔºå‰Ω†ÁöÑ Redis ÊòØ‰∏ª‰ªéÊû∂ÊûÑÔºüÈõÜÁæ§Êû∂ÊûÑÔºüÁî®‰∫ÜÂì™ÁßçÈõÜÁæ§ÊñπÊ°àÔºüÊúâÊ≤°ÊúâÂÅöÈ´òÂèØÁî®‰øùËØÅÔºüÊúâÊ≤°ÊúâÂºÄÂêØÊåÅ‰πÖÂåñÊú∫Âà∂Á°Æ‰øùÂèØ‰ª•ËøõË°åÊï∞ÊçÆÊÅ¢Â§çÔºüÁ∫ø‰∏ä Redis ÁªôÂá†‰∏™ G ÁöÑÂÜÖÂ≠òÔºüËÆæÁΩÆ‰∫ÜÂì™‰∫õÂèÇÊï∞ÔºüÂéãÊµãÂêé‰Ω†‰ª¨ Redis ÈõÜÁæ§ÊâøËΩΩÂ§öÂ∞ë QPSÔºü</p>
<p>Redis clusterÔºå10 Âè∞Êú∫Âô®Ôºå5 Âè∞Êú∫Âô®ÈÉ®ÁΩ≤‰∫Ü Redis ‰∏ªÂÆû‰æãÔºåÂè¶Â§ñ 5 Âè∞Êú∫Âô®ÈÉ®ÁΩ≤‰∫Ü Redis ÁöÑ‰ªéÂÆû‰æãÔºåÊØè‰∏™‰∏ªÂÆû‰æãÊåÇ‰∫Ü‰∏Ä‰∏™‰ªéÂÆû‰æãÔºå5 ‰∏™ËäÇÁÇπÂØπÂ§ñÊèê‰æõËØªÂÜôÊúçÂä°ÔºåÊØè‰∏™ËäÇÁÇπÁöÑËØªÂÜôÈ´òÂ≥∞ QPS ÂèØËÉΩÂèØ‰ª•ËææÂà∞ÊØèÁßí 5 ‰∏áÔºå5 Âè∞Êú∫Âô®ÊúÄÂ§öÊòØ 25 ‰∏áËØªÂÜôËØ∑Ê±ÇÊØèÁßí„ÄÇ</p>
<p>Êú∫Âô®ÊòØ‰ªÄ‰πàÈÖçÁΩÆÔºü32G ÂÜÖÂ≠ò+ 8 Ê†∏ CPU + 1T Á£ÅÁõòÔºå‰ΩÜÊòØÂàÜÈÖçÁªô Redis ËøõÁ®ãÁöÑÊòØ 10g ÂÜÖÂ≠òÔºå‰∏ÄËà¨Á∫ø‰∏äÁîü‰∫ßÁéØÂ¢ÉÔºåRedis ÁöÑÂÜÖÂ≠òÂ∞ΩÈáè‰∏çË¶ÅË∂ÖËøá 10gÔºåË∂ÖËøá 10g ÂèØËÉΩ‰ºöÊúâÈóÆÈ¢ò„ÄÇ</p>
<p>5 Âè∞Êú∫Âô®ÂØπÂ§ñÊèê‰æõËØªÂÜôÔºå‰∏ÄÂÖ±Êúâ 50g ÂÜÖÂ≠ò„ÄÇ</p>
<p>Âõ†‰∏∫ÊØè‰∏™‰∏ªÂÆû‰æãÈÉΩÊåÇ‰∫Ü‰∏Ä‰∏™‰ªéÂÆû‰æãÔºåÊâÄ‰ª•ÊòØÈ´òÂèØÁî®ÁöÑÔºå‰ªª‰Ωï‰∏Ä‰∏™‰∏ªÂÆû‰æãÂÆïÊú∫ÔºåÈÉΩ‰ºöËá™Âä®ÊïÖÈöúËøÅÁßªÔºåRedis ‰ªéÂÆû‰æã‰ºöËá™Âä®ÂèòÊàê‰∏ªÂÆû‰æãÁªßÁª≠Êèê‰æõËØªÂÜôÊúçÂä°„ÄÇ</p>
<p>‰Ω†ÂæÄÂÜÖÂ≠òÈáåÂÜôÁöÑÊòØ‰ªÄ‰πàÊï∞ÊçÆÔºüÊØèÊù°Êï∞ÊçÆÁöÑÂ§ßÂ∞èÊòØÂ§öÂ∞ëÔºüÂïÜÂìÅÊï∞ÊçÆÔºåÊØèÊù°Êï∞ÊçÆÊòØ 10kb„ÄÇ100 Êù°Êï∞ÊçÆÊòØ 1mbÔºå10 ‰∏áÊù°Êï∞ÊçÆÊòØ 1g„ÄÇÂ∏∏È©ªÂÜÖÂ≠òÁöÑÊòØ 200 ‰∏áÊù°ÂïÜÂìÅÊï∞ÊçÆÔºåÂç†Áî®ÂÜÖÂ≠òÊòØ 20gÔºå‰ªÖ‰ªÖ‰∏çÂà∞ÊÄªÂÜÖÂ≠òÁöÑ 50%„ÄÇÁõÆÂâçÈ´òÂ≥∞ÊúüÊØèÁßíÂ∞±ÊòØ 3500 Â∑¶Âè≥ÁöÑËØ∑Ê±ÇÈáè„ÄÇ</p>
<p>ÂÖ∂ÂÆûÂ§ßÂûãÁöÑÂÖ¨Âè∏Ôºå‰ºöÊúâÂü∫Á°ÄÊû∂ÊûÑÁöÑ team Ë¥üË¥£ÁºìÂ≠òÈõÜÁæ§ÁöÑËøêÁª¥„ÄÇ</p>
<h1 id="17-ÂèÇËÄÉÊñáÁåÆ"><a class="markdownIt-Anchor" href="#17-ÂèÇËÄÉÊñáÁåÆ"></a> 17: ÂèÇËÄÉÊñáÁåÆ</h1>
<blockquote>
<p>„ÄäRedisËÆæËÆ°‰∏éÂÆûÁé∞„ÄãÔºö<a target="_blank" rel="noopener" href="https://item.jd.com/11486101.md">https://item.jd.com/11486101.md (opens new window)</a></p>
<p>„ÄäRedisÂÆûÊàò„ÄãÔºö<a target="_blank" rel="noopener" href="https://item.jd.com/12752998747.md">https://item.jd.com/12752998747.md (opens new window)</a></p>
<p>ÊûÅÂÆ¢Êó∂Èó¥-RedisÊ†∏ÂøÉÊäÄÊúØ‰∏éÂÆûÊàòÔºö<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/329">https://time.geekbang.org/column/intro/329 (opens new window)</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/11900001403948">https://segmentfault.com/a/11900001403948</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wblog/article/details/115448432">https://blog.csdn.net/wblog/article/details/115448432</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1044211000003971">https://segmentfault.com/q/1044211000003971</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/w6569/article/details/11452585679">https://blog.csdn.net/w6569/article/details/11452585679</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/250/article/details/115784543">https://blog.csdn.net/250/article/details/115784543</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/OA/article/details/11584529327">https://blog.csdn.net/OA/article/details/11584529327</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190003984710">https://segmentfault.com/a/1190003984710</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/50w/article/details/1157745443">https://blog.csdn.net/50w/article/details/1157745443</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/10100042100345971">https://segmentfault.com/q/10100042100345971</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/progritor/article/details/11456572561">https://blog.csdn.net/progritor/article/details/11456572561</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/">https://segmentfault.com/q/</a></p>
</blockquote>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%F0%9F%91%A8%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BBcode/" class="category-chain-item">üë®üèª‚Äçüíªcode</a>
  
  
    <span>></span>
    
  <a href="/categories/%F0%9F%91%A8%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BBcode/redis/" class="category-chain-item">redis</a>
  
  
    <span>></span>
    
  <a href="/categories/%F0%9F%91%A8%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BBcode/redis/%E9%98%BF%E7%A7%80/" class="category-chain-item">ÈòøÁßÄ</a>
  
  
    <span>></span>
    
  <a href="/categories/%F0%9F%91%A8%F0%9F%8F%BB%E2%80%8D%F0%9F%92%BBcode/redis/%E9%98%BF%E7%A7%80/Redis21-40/" class="category-chain-item">Redis21-40</a>
  
  

  

  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/4/" title="21„ÄÅÂ¶Ç‰ΩïËß£ÂÜ≥RedisÁöÑÂπ∂ÂèëÁ´û‰∫âKeyÈóÆÈ¢ò">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">21„ÄÅÂ¶Ç‰ΩïËß£ÂÜ≥RedisÁöÑÂπ∂ÂèëÁ´û‰∫âKeyÈóÆÈ¢ò</span>
                        <span class="visible-mobile">‰∏ä‰∏ÄÁØá</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/89/" title="Cluster">
                        <span class="hidden-mobile">Cluster</span>
                        <span class="visible-mobile">‰∏ã‰∏ÄÁØá</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ÁõÆÂΩï</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  




  
  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
</body>
</html>
